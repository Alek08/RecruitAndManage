# RecruitAndManage
<br />
Front-end: Angular
<br />
Beck-end: .Net Core Web Api
<br />
Database: Microsoft SQL
<br />

Additionally
<br />
Repository-Service Pattern <br />
Repository Design Pattern = One repository per entity + Generic repository<br />
UnitOfWork pattern <br />
Entity Framework Core<br />
NewtonsoftJson<br />
Serilog<br />
AutoMapper<br />
JWT Authentication<br />
JWT Authorization<br />
Build-in DI system<br />
LINQ<br />
JQuery <br />
Bootstrap <br />
 

RecruitAndManage is an app that can help job seekers find their jobs and at the same time help recruiters manage the recruitment process online.

<b>Home</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/1.jpg">
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/11.jpg">
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/111.jpg">
<br />



<b>Sign In Candidate</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/sign in candidate.jpg">
<br />
<b>Sign In Recruiter</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/sign in recruiter.jpg">
<br />




<b>Register Candidate</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/register candidate.jpg">
<br />
<b>Register Recruiter</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/register recruiter.jpg">
<br />



<b>Create Company</b>
<p>Recruiter who creates the company is the Recruiter Admin this Admin can add others recruiters
that belongs to the same company. </p>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/create company.jpg">
<br />

<b>Edit Company</b>
<p>Only the Admin Recruiter can Edit the Company</p>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/edit company.jpg">
<br />



<b>Profile Company</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/company profile.jpg">
<br />


<b>Create Job</b>
<p>Any recruiter can add jobs and edit them</p>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/create job.jpg" >
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/create job 1.jpg">
<br />


<b>Edit Job</b>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/edit job.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/edit job 1.jpg">
<br />

<b>Candidate Dashboard</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candiate dashboard.jpg">
<br />


<b>Candidate Profile</b>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candidate profile2.jpg">
<br />


<b>Candidate View Jobs</b>
<p>
If the job expires for more than 3 days then it is green
if the job is already expired it is red and candidates can not applied to it
if the job expires for less than 3 days it is yellow </p>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candidate view jobs.jpg">
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candidate view vaid job.jpg">
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candidate view expired job.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/candidate view expired job 2.jpg">
<br />


<b>Recruiter View Jobs</b>
<p>Recruiters can create a Recruitment Process usually when the job expires.They can also see the number of applicants and the candidates on the Candidates green button.Once started it is created and they can not create second recruitment process for same job if they want see the recruitment process or to delete it they can do it in Recruitment Process Managment</p>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/recruiter view jobs.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/recruiter view candidates for job.jpg">
<br />


<b>Recruitment Process Managment</b>
<p>Once created Recruitment Processes are shown in a table.The Recruiter can delete or see the Recruitment Process</p>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/recruitment process managment.jpg">
<br />

<p>Recruiters can customize their Recruitment Process based on their needs.They can add Custom  tabs names</p>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/start rp.jpg">
<br />
<p>
Because recruitment process last a couple of weeks all tabs and candidates in tabs for specific recruitment process are all saved
</p>


 
<b>Recruitment Process</b>
<p>
The First tab always has all the candidates.The recruiter can create as many tabs as the recruitment process last and to add candiates based on Candidates Performance in next tab with the Next button or with the Back button to bring them back in the previous tab if the recruiter made some mistake and unintentionally adds candidate in next tab where it does not belong.
 </p>
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/viewCandidateAction.jpg">
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/viewCvAction.jpg">
<br />


<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/pre selection.jpg">
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/pre selection 1.jpg">
<br />


<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/first interview.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/first interview 1.jpg">
<br />



<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/testing.jpg">
<br />

<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/testing 1.jpg">
<br />



<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/second interview.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/second interview 1.jpg">
<br />






<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/welcome.jpg">
<br />


<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/welcome 1.jpg">
<br />


<h2>Implementation</h2>
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/merge.jpg">
<br />





<b>Program.cs</b>
<br />
```
  public class Program
    {
        public static void Main(string[] args)
        {
            var config = new ConfigurationBuilder().AddJsonFile("appsettings.Serilog.json").Build();

            Log.Logger = new LoggerConfiguration()
               .ReadFrom.Configuration(config)
               //.WriteTo.Console()
               .CreateLogger();

            try
            {
                Log.Information("app starting");

                CreateHostBuilder(args).Build().Run();

            }
            catch (Exception e)
            {
                Log.Fatal("app fatal" + e.Message);
            }
            finally
            {
                Log.CloseAndFlush();
            }        
      
        }

        public static IHostBuilder CreateHostBuilder(string[] args) =>
            Host.CreateDefaultBuilder(args).UseSerilog()
                .ConfigureWebHostDefaults(webBuilder =>
                {
                    webBuilder.UseStartup<Startup>();
                });

    }


```



<b>Startup.cs</b>
<br />
```
 public class Startup
    {
        IConfiguration configuration;

        public Startup(IConfiguration configuration)
        {
            this.configuration = configuration;
        }

        public void ConfigureServices(IServiceCollection services)
        {
            services.AddControllers().AddNewtonsoftJson(config =>
            {
                config.SerializerSettings.ReferenceLoopHandling = ReferenceLoopHandling.Ignore;

            });



            services.AddScoped<IUnitOfWork, UnitOfWork>();


            services.AddScoped<IRecruiterRepository, RecruiterRepository>();
            services.AddScoped<ICandidateRepository, CandidateRepository>();
            services.AddScoped<ICompanyRepository, CompanyRepository>();
            services.AddScoped<IJobRepository, JobRepository>();
            services.AddScoped<ICvRepository, CvRepository>();//cv repo will get managed in candidate repo
            services.AddScoped<IRecruitmentProcessRepository, RecruitmentProcessRepository>();
            services.AddScoped<ITabRepository, TabRepository>();


            services.AddScoped<IAccountService, AccountService>();
            services.AddScoped<ICompanyService, CompanyService>();
            services.AddScoped<IJobService, JobService>();
            services.AddScoped<IRecruitmentProcessService, RecruitmentProcessService>();
            services.AddScoped<ITabService, TabService>();


            services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());


            services.AddDbContextPool<AppDbContext>(
                config =>
                {
                    config.UseSqlServer(configuration.GetConnectionString("conn"))
                    .EnableSensitiveDataLogging();
                });


            services.AddCors(options =>
            {
                options.AddPolicy("AllowAngular", policy =>
                policy.WithOrigins("http://localhost:4200").AllowAnyHeader()
                .AllowAnyMethod());
            });


            services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme).AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, config =>
            {
                config.TokenValidationParameters = new TokenValidationParameters
                {
                    ValidateIssuer = true,
                    ValidIssuer = configuration["Security:Tokens:Issuer"],
                    ValidateAudience = true,
                    ValidAudience = configuration["Security:Tokens:Audience"],
                    ValidateIssuerSigningKey = true,
                    IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration["Security:Tokens:Key"])),
                };
            });

            services.AddAuthorization(config =>
            {
                config.AddPolicy("AdminRecruiter", policyBuilder =>
                {
                    policyBuilder.RequireClaim("Admin");
                });
                config.AddPolicy("Recruiter", policyBuilder =>
                {
                    policyBuilder.RequireClaim("Recruiter");
                });
                config.AddPolicy("RegisteredCandidate", policyBuilder =>
                {
                    policyBuilder.RequireClaim("Candidate");
                });

            });
        }


        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }
            else
            {
                app.UseExceptionHandler();
            }
            
            app.UseSerilogRequestLogging();

            app.UseRouting();

            app.UseCors("AllowAngular");

            app.UseAuthentication();

            app.UseAuthorization();

            app.UseEndpoints(endpoints =>
            {
                endpoints.MapControllers();
            });
        }
    }


```


<b>AppDbContext.cs</b>
<br />
```
 public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
        {

        }

        public DbSet<Recruiter> Recruiters { get; set; }
        public DbSet<Company> Companies { get; set; }
        public DbSet<Job> Jobs { get; set; }
        public DbSet<Candidate> Candidates { get; set; }
        public DbSet<CV> Cvs { get; set; }
        public DbSet<RecruitmentProcess> RecruitmentProcesses { get; set; }
        public DbSet<Tab> Tabs { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {

            //many to many
            modelBuilder.Entity<Review>()
          .HasKey(r => new { r.CandidateId, r.CompanyId });

            modelBuilder.Entity<Review>()
                .HasOne(c => c.Company)
                .WithMany(r => r.reviews)
                .HasForeignKey(fk => fk.CompanyId);

            modelBuilder.Entity<Review>()
                .HasOne(c => c.Candidate)
                .WithMany(r => r.reviews)
                .HasForeignKey(fk => fk.CandidateId);

            modelBuilder.Entity<Recruiter>()
                   .HasOne(r => r.company)
                   .WithMany(c => c.recruiters)
                   .OnDelete(DeleteBehavior.SetNull); //on delete set null


            //many to many canidate job
            modelBuilder.Entity<CandidateJob>()
                .HasKey(cj => new { cj.CandidateId, cj.JobId });

            modelBuilder.Entity<CandidateJob>()
                .HasOne(c => c.candidate)
                .WithMany(cj => cj.jobs)
                .HasForeignKey(fk => fk.CandidateId);

            modelBuilder.Entity<CandidateJob>()
                .HasOne(j => j.job)
                .WithMany(cj => cj.candidates)
                .HasForeignKey(fk => fk.JobId);


            //many to many
            modelBuilder.Entity<RecruitmentProcessCandidate>()
                .HasKey(rpc => new { rpc.recruitmentProcessId, rpc.CandidateId });

            modelBuilder.Entity<RecruitmentProcessCandidate>()
                .HasOne(rpc => rpc.candidate)
                .WithMany(c => c.recruitmentProcesses)
                .HasForeignKey(fk => fk.CandidateId);

            modelBuilder.Entity<RecruitmentProcessCandidate>()
                .HasOne(rpc => rpc.recruitmentProcess)
                .WithMany(rp => rp.candidates)
                .HasForeignKey(fk => fk.recruitmentProcessId);



            //many to many Tab and Candidate
            modelBuilder.Entity<TabCandidate>()
                .HasKey(tc => new { tc.TabId, tc.CandidateId });
            
            modelBuilder.Entity<TabCandidate>()
                .HasOne(tc => tc.candidate)
                .WithMany(c => c.tabs)
                .HasForeignKey(fk => fk.CandidateId);

            modelBuilder.Entity<TabCandidate>()
                .HasOne(tc => tc.tab)
                .WithMany(t => t.candidates)
                .HasForeignKey(fk => fk.TabId);



        }
    }
```

<b>Repositories</b>
<br />
<b>interfaces</b>
<br />
```

 public interface IBaseRepository<T> where T : class
    {
        Task<bool> Add(T entity);

        bool AddWithRelatedEntites(T entity);

        Task<T> GetById(int id);

        Task<IEnumerable<T>> GetAll();

        bool Update(T entity);

        bool Deatach(T entity);

        Task<bool> Delete(int id);

        Task<IEnumerable<T>> FindExpression(Expression<Func<T, bool>> expression);
    }


    public interface ICandidateRepository:IBaseRepository<Candidate>
    {
        Task<Candidate> GetCandidateWithRelativeEntity(Candidate candidate);
        Task<CV> GetCandidateCv(int cvId);
    }


    public interface ICompanyRepository : IBaseRepository<Company>
    {
        Task<Company> GetCompanyWithRelated(Company company);
    }
    
    public interface ICvRepository:IBaseRepository<CV>
    {
    }

    public interface IJobRepository:IBaseRepository<Job>
    {
          Task<Job> GetJobWithRelatedEntities(Job job,bool includeCandidates);
    }


    public interface IRecruiterRepository:IBaseRepository<Recruiter>
    {
        Task<Recruiter> GetRecruiterWithRelativeEntity(Recruiter recruiter);
    }


    public interface IRecruitmentProcessRepository : IBaseRepository<RecruitmentProcess>
    {
        Task<IEnumerable<RecruitmentProcess>> GetForRecruiter(string email);

        Task<RecruitmentProcess> FindRecruitmentProcessByJobId(int jobId);

        Task<RecruitmentProcess> GetRecruitmentProcessWithRelativeEntity(RecruitmentProcess recruitmentProcess);

        Task<bool> DeleteRecruitmentProcessCandidateJoinTable(RecruitmentProcess recruitmentProcess);
    }



    public interface ITabRepository:IBaseRepository<Tab>
    {
        Task<bool> DeleteCandidateFromTab(TabCandidate tabCandidate);

        Task<Tab> GetTabWithRelative(Tab tab, bool includeCandidates);
    }


    public interface IUnitOfWork
    {
        IRecruiterRepository RecruiterRepository { get; }

        ICandidateRepository CandidateRepository { get; }

        ICompanyRepository CompanyRepository { get; }

        IJobRepository JobRepository { get; }

        ICvRepository CvRepository { get; }

        IRecruitmentProcessRepository RecruitmentProcessRepository { get; }

        ITabRepository TabRepository { get; }

        public void ChangeTrackerDetectChanges();

        Task<bool> SaveContext();
    }





```



<b>Repositories</b>
<br />
<b>Implementations</b>
<br />
```
 public class BaseRepository<T> : IBaseRepository<T> where T : class
    {
        protected AppDbContext dbContext;
       
        public BaseRepository(AppDbContext dbContext)
        {
            this.dbContext = dbContext;
        }

     
        public async Task<bool> Add(T entity)
        {
            try 
            {
                await dbContext.Set<T>().AddAsync(entity);
                return true;
            }
            catch (Exception e) 
            {
                return false;
            }           
        }



        public bool AddWithRelatedEntites(T entity)
        {
            try 
            {
                dbContext.ChangeTracker.DetectChanges();

                dbContext.Attach(entity);

                return true;
            }
            catch (Exception e) 
            {
                return false;
            }
      
        }

        public async Task<T> GetById(int id)
        {
            return await dbContext.Set<T>().FindAsync(id); 
        }

        public async Task<IEnumerable<T>> GetAll()
        {
            return await dbContext.Set<T>().ToListAsync();
        }

        public bool Update(T entity)
        {
            try
            {
                dbContext.Entry(entity).State = EntityState.Modified;

                return true;
            }
            catch (Exception e)
            {
                var a = e.Message;

                return false;
            }       
        }

        public async Task<bool> Delete(int id)
        {
            T entity = await dbContext.Set<T>().FindAsync(id);
            try
            {
                dbContext.Set<T>().Remove(entity);

                return true;
            }
            catch (Exception e)
            {
                return false;
            }          
        }


        public bool Deatach(T entity)
        {
            try 
            {
                dbContext.Entry(entity).State = EntityState.Detached;

                return true;
            }
            catch (Exception e) 
            {
                return false;
            }    
        }


        public async Task<IEnumerable<T>> FindExpression(Expression<Func<T, bool>> expression)
        {
            var query = dbContext.Set<T>().Where(expression);

            var results = await query.ToListAsync();

            return results;
        }
    }




 public class CandidateRepository:BaseRepository<Candidate>,ICandidateRepository
    {

        AppDbContext appDbContext;
        public CandidateRepository(AppDbContext appDbContext):base(appDbContext)
        {
            this.appDbContext = appDbContext;

        }

        public async Task<Candidate> GetCandidateWithRelativeEntity(Candidate candidate)
        { 
            appDbContext.Attach(candidate);

            await appDbContext.Entry(candidate).Collection(c => c.reviews).LoadAsync();

            await appDbContext.Entry(candidate).Collection(c => c.jobs).LoadAsync();

            await appDbContext.Entry(candidate).Reference(c => c.Cv).LoadAsync();
        
            return candidate;
        }

        public async Task<CV> GetCandidateCv(int cvId)
        {
            var cv = appDbContext.Cvs.Where(c => c.Id.Equals(cvId)).FirstOrDefault();

            return cv;
        }
    }





 public class CompanyRepository:BaseRepository<Company>,ICompanyRepository
    {
        AppDbContext appDbContext;
        public CompanyRepository(AppDbContext appDbContext):base(appDbContext)
        {
            this.appDbContext = appDbContext;
        }

        public async Task<Company> GetCompanyWithRelated(Company company)
        {
            appDbContext.Attach(company);

            await appDbContext.Entry(company).Collection(c => c.recruiters).LoadAsync();

            await appDbContext.Entry(company).Collection(c => c.jobs).LoadAsync();

            return company;
        }
    }



 public class CvRepository : BaseRepository<CV>,ICvRepository
    {
       AppDbContext appDbContext;
        public CvRepository(AppDbContext appDbContext) : base(appDbContext)
        {
            this.appDbContext = appDbContext;
        }
    }



  public class JobRepository : BaseRepository<Job>,IJobRepository
    {
        AppDbContext appDbContext;
        public JobRepository(AppDbContext appDbContext):base(appDbContext)
        {
            this.appDbContext = appDbContext;
        }

        public async Task<Job> GetJobWithRelatedEntities(Job job,bool includeCandidates)
        {
            appDbContext.Attach(job);

            await appDbContext.Entry(job).Reference(r => r.company).LoadAsync();

            await appDbContext.Entry(job).Reference(j => j.recruiter).LoadAsync();

            if (includeCandidates)
            {
                await appDbContext.Jobs.Where(j => j.Id == job.Id)
                    .Include(j => j.candidates)
                    .ThenInclude(c => c.candidate).ToListAsync();    
            }

            return job;
        }
    }



 public class RecruiterRepository : BaseRepository<Recruiter>, IRecruiterRepository
    {
        AppDbContext appDbContext;

        public RecruiterRepository(AppDbContext appDbContext) : base(appDbContext)
        {
            this.appDbContext = appDbContext;
        }

        public async Task<Recruiter> GetRecruiterWithRelativeEntity(Recruiter recruiter)
        {
            appDbContext.Attach(recruiter);

            await appDbContext.Entry(recruiter).Reference(r => r.company).LoadAsync(); 

            await appDbContext.Entry(recruiter).Collection(j => j.jobs).LoadAsync();

            return recruiter;
        }
    }

      public class RecruitmentProcessRepository : BaseRepository<RecruitmentProcess>, IRecruitmentProcessRepository
    {
        AppDbContext appDbContext;
        public RecruitmentProcessRepository(AppDbContext appDbContext) : base(appDbContext)
        {
            this.appDbContext = appDbContext;

        }


        public async Task<IEnumerable<RecruitmentProcess>> GetForRecruiter(string email)
        {
            var recruitmentProcesses = await appDbContext.RecruitmentProcesses.Where(r => r.job.recruiter.Email.Equals(email)).ToListAsync();

            return recruitmentProcesses;
        }


        public async Task<RecruitmentProcess> GetRecruitmentProcessWithRelativeEntity(RecruitmentProcess recruitmentProcess)
        {
            await appDbContext.RecruitmentProcesses.Where(r => r.Id == recruitmentProcess.Id)
                .Include(rp => rp.candidates)
                .ThenInclude(rpc => rpc.candidate)
                .Include(rp => rp.job).ThenInclude(j => j.recruiter)
                .Include(t => t.tabs)
                .ToListAsync();

            return recruitmentProcess;
        }


        public async Task<RecruitmentProcess> FindRecruitmentProcessByJobId(int jobId)
        {
            var recruitmentProcess = await appDbContext.RecruitmentProcesses.Where(r => r.job.Id.Equals(jobId))
                .Include(rp => rp.candidates)
                .ThenInclude(rpc => rpc.candidate)
                .Include(rp => rp.job)
                .ToListAsync();

            return recruitmentProcess.FirstOrDefault();
        }





  public async Task<bool> DeleteRecruitmentProcessCandidateJoinTable(RecruitmentProcess recruitmentProcess)
   {
            appDbContext.Attach(recruitmentProcess);

            await appDbContext.Entry(recruitmentProcess).Collection(rp => rp.candidates).LoadAsync();

            var candidates = recruitmentProcess.candidates;

            try
            {
                appDbContext.RemoveRange(candidates);

                return true;
            }
            catch (Exception e)
            {
                return false;

            }
        }
    }

    public class TabRepository : BaseRepository<Tab>, ITabRepository
    {

        AppDbContext appDbContext;

        public TabRepository(AppDbContext appDbContext) : base(appDbContext)
        {
            this.appDbContext = appDbContext;
        }

        public async Task<bool> DeleteCandidateFromTab(TabCandidate tabCandidate)
        {
            try
            {
                dbContext.Entry(tabCandidate).State = EntityState.Deleted;

                return true;
            }
            catch (Exception e)
            {
                return false;

            }
        }

        public async Task<Tab> GetTabWithRelative(Tab tab, bool includeCandidates)
        {
            await appDbContext.Tabs.Where(t => t.Id == tab.Id)
                .Include(t => t.recruitmentProcess).ToListAsync();

            if (includeCandidates)
            {
                await appDbContext.Tabs.Where(t => t.Id == tab.Id)
                .Include(t => t.candidates).ThenInclude(c => c.candidate).ToListAsync();
            }
            return tab;
        }
    }




     public class UnitOfWork : IUnitOfWork
    {
        AppDbContext appDbContext;

        private IRecruiterRepository recruiterRepository;
        private ICandidateRepository candidateRepository;
        private ICompanyRepository companyRepository;
        private IJobRepository jobRepository;
        private ICvRepository cvRepository;
        private IRecruitmentProcessRepository recruitmentProcessRepository;
        private ITabRepository tabRepository;

        public UnitOfWork(AppDbContext appDbContext)
        {
            this.appDbContext = appDbContext;
        }

        public IRecruiterRepository RecruiterRepository => recruiterRepository = recruiterRepository ?? new RecruiterRepository(appDbContext);

        public ICandidateRepository CandidateRepository => candidateRepository= candidateRepository ?? new CandidateRepository(appDbContext);

        public ICompanyRepository CompanyRepository => companyRepository = companyRepository ?? new CompanyRepository(appDbContext);
    
        public IJobRepository JobRepository => jobRepository = jobRepository ?? new JobRepository(appDbContext);

        public ICvRepository CvRepository => cvRepository = cvRepository ?? new CvRepository(appDbContext);

        public IRecruitmentProcessRepository RecruitmentProcessRepository => recruitmentProcessRepository = recruitmentProcessRepository ?? new RecruitmentProcessRepository(appDbContext);

        public ITabRepository TabRepository => tabRepository = tabRepository ?? new TabRepository(appDbContext);

        public void ChangeTrackerDetectChanges()
        {
             appDbContext.ChangeTracker.DetectChanges();
        }

        public async Task<bool> SaveContext()
        {  
            try
            { 
                return await appDbContext.SaveChangesAsync()>0;
            }
            catch (Exception e)
            {
                var message = e.Message;
                return false;
            }
        }
    }

```


<b>Services</b>
<br />
<b>interface</b>
<br />
```

    public interface IBaseService
    {
        public void ChangeTrackerDetectChanges();
        public Task<bool> SaveContext();
    }


    public interface IAccountService : IBaseService
    {
        Task<bool> AddCandidate(Candidate candidate);

        Task<Candidate> GetCandidateById(int id);

        Task<bool> UpdateCandidate(Candidate candidate);

        Task<Candidate> GetCandidate(Candidate candidate);

        Task<Candidate> GetCandidateByEmail(string email);

        Task<CV> GetCandidateCV(int cvId);

        Task<bool> DeleteCandidateCV(int cvId);

        Task<bool> AddRecuiter(Recruiter recruiter);

        Task<Recruiter> GetRecuiter(Recruiter recruiter);

        Task<Recruiter> GetRecuiterByEmail(string email);

        string IssueCandidateJwtToken(Candidate candidate);

        string IssueRecruiterJwtToken(Recruiter recruiter, ClaimsLevel level);

        Task<Recruiter> GetRecuiterById(int id);
    }

  
    public interface ICompanyService : IBaseService
    {
        Task<bool> AddRecruiterToCompany(Recruiter recruiter, Company company);

        Task<bool> DeleteRecruiterFromCompany(int id);

        Task<bool> AddCompany(Company company);

        Task<Company> GetCompanyByName(string companyName);

        Task<Company> GetCompanyWithRelated(int id);

        bool UpdateCompany(Company company);

        Task<Company> GetCompanyById(int id);
    }

     public interface IJobService : IBaseService
    {

        Task<bool> AddJob(Job job);

        Task<Job> CandidateGetJobById(int id);

        Task<Job> RecruiterGetJob(int id, string email);

        Task<string> CandidateAppliedForJob(int candidateid, int jobId);

        Task<IEnumerable<Job>> GetAllJobsForRecruiter(Recruiter recruiter);

        Task<IEnumerable<Job>> GetAllJobsForCandidate();

        Task<IEnumerable<Job>> GetJobsForCandidateByTitle(string jobTitle);

        bool UpdateJob(Job job, Job jobFromDatabase);

        bool Deatach(Job entity);

    }


     public interface IRecruitmentProcessService : IBaseService
    {
        Task<RecruitmentProcess> GetRecruitmentProcessById(int id);

        Task<RecruitmentProcess> FindRecruitmentProcessByJobId(int jobId);

        Task<bool> CheckRecruitmentProcessByJobId(int jobId);

        Task<bool> DeleteRecruitmentProcessById(int recruitmentProcessId);

        Task<bool> DeleteRecruitmentProcessCandidateJoinTable(int recruitmentProcessId);

        Task<bool> AddRecruitmentProcess(RecruitmentProcess recruitmentProcess);

        Task<IEnumerable<RecruitmentProcess>> GetAllRecruitmentProcessForRecruiterWithRelative(string email);

        void AddCandidatesToRecruitmentProcess(RecruitmentProcess recruitmentProcess, IList<CandidateJob> candidates);
    }


     public interface ITabService : IBaseService
    {
        IList<Tab> SearchedCandidates(IList<Tab> tabs, string searchQuery);

        Task<bool> DeleteCandidateFromTab(TabCandidate tabCandidate);

        Task<Tab> GetTabWithRelative(Tab tab, bool includeCandidates);

        Task<bool> CreateTab(Tab tab);

        Task<bool> DeleteTab(int tabId);
    }

```
<b>Services</b>
<br />
<b>Implementation</b>
<br />
```
 public class AccountService : IAccountService
    {
        IUnitOfWork unitOfWork;
        IConfiguration configuration;
        public AccountService(IUnitOfWork unitOfWork, IConfiguration configuration)
        {
            this.unitOfWork = unitOfWork;
            this.configuration = configuration;
        }

        public async Task<bool> SaveContext()
        {
            return await unitOfWork.SaveContext();
        }

        public async Task<bool> UpdateCandidate(Candidate candidate)
        {
            return unitOfWork.CandidateRepository.Update(candidate);
        }

        public async Task<Candidate> GetCandidate(Candidate candidate)
        {
            var candidates = await unitOfWork.CandidateRepository.FindExpression(c =>

            c.Email.Equals(candidate.Email) && c.Password.Equals(candidate.Password));

            var candidate_ = candidates.FirstOrDefault();//first or null

            if (candidate_ != null)
            {
                await unitOfWork.CandidateRepository.GetCandidateWithRelativeEntity(candidate_);

                return candidate_;
            }
            else
            {
                return null;
            }

        }

        public async Task<bool> AddCandidate(Candidate candidate)
        {
            return await unitOfWork.CandidateRepository.Add(candidate);
        }

        public async Task<bool> AddRecuiter(Recruiter recruiter)
        {
            return await unitOfWork.RecruiterRepository.Add(recruiter);
        }


        public async Task<Recruiter> GetRecuiter(Recruiter recruiter)
        {
            var recruiters = await unitOfWork.RecruiterRepository.FindExpression(r =>

            r.Email.Equals(recruiter.Email) && r.Password.Equals(recruiter.Password));

            var recruiter_ = recruiters.FirstOrDefault();//first or null

            if (recruiter_ != null)
            {
                await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(recruiter_);

                return recruiter_;
            }
            else
            {
                return null;
            }
        }

        public async Task<Recruiter> GetRecuiterById(int id)
        {
            var recruiter = await unitOfWork.RecruiterRepository.GetById(id);

            await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(recruiter);

            return recruiter;
        }

        public async Task<Candidate> GetCandidateById(int id)
        {
            var candidate = await unitOfWork.CandidateRepository.GetById(id);

            await unitOfWork.CandidateRepository.GetCandidateWithRelativeEntity(candidate);

            return candidate;
        }

        public async Task<Recruiter> GetRecuiterByEmail(string email)
        {
            var recruiters = await unitOfWork.RecruiterRepository.FindExpression(r =>

             r.Email.Equals(email));

            var recruiter_ = recruiters.FirstOrDefault();//first or null

            if (recruiter_ != null)
            {
                await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(recruiter_);

                return recruiter_;
            }
            else
            {
                return null;
            }
        }

        public async Task<Candidate> GetCandidateByEmail(string email)
        {
            var candidates = await unitOfWork.CandidateRepository.FindExpression(r =>

          r.Email.Equals(email));

            var candidate = candidates.FirstOrDefault();//first or null

            if (candidate != null)
            {
                await unitOfWork.CandidateRepository.GetCandidateWithRelativeEntity(candidate);

                return candidate;
            }
            else
            {
                return null;
            }
        }

        public async Task<CV> GetCandidateCV(int cvId)
        {
            var cv = await unitOfWork.CandidateRepository.GetCandidateCv(cvId);

            return cv;
        }

        public async Task<bool> DeleteCandidateCV(int cvId)
        {
            return await unitOfWork.CvRepository.Delete(cvId);

        }

        public void ChangeTrackerDetectChanges()
        {
            unitOfWork.ChangeTrackerDetectChanges();
        }

        public string IssueCandidateJwtToken(Candidate candidate)
        {
            var claims = new[]
            {
                  new Claim(ClaimTypes.Name,candidate.FullName),
                  new Claim(ClaimTypes.Email,candidate.Email),
                  new Claim("Candidate","true")
            };

            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration["Security:Tokens:Key"]));

            var creds = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

            var token = new JwtSecurityToken(configuration["Security:Tokens:Issuer"], configuration["Security:Tokens:Audience"],
            claims,
            expires: DateTime.Now.AddMinutes(30),
            signingCredentials: creds);

            var tokenText = new JwtSecurityTokenHandler().WriteToken(token);

            return tokenText;
        }



        public string IssueRecruiterJwtToken(Recruiter recruiter, ClaimsLevel level)
        {
            Claim[] claims = null;

            if (level.Equals(ClaimsLevel.NoAdmin))
            {
                claims = new[]{
                    new Claim(ClaimTypes.Name,recruiter.FullName),
                    new Claim(ClaimTypes.Email,recruiter.Email),
                    new Claim("Recruiter","true")
                };

            }
            else if (level.Equals(ClaimsLevel.Admin))
            {
                claims = new[]{
                    new Claim(ClaimTypes.Name,recruiter.FullName),
                    new Claim(ClaimTypes.Email,recruiter.Email),
                    new Claim("Recruiter","true"),
                    new Claim("Admin","true")
              };
            }

            var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(configuration["Security:Tokens:Key"]));

            var creds = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

            var token = new JwtSecurityToken(configuration["Security:Tokens:Issuer"], configuration["Security:Tokens:Audience"],
            claims,
            expires: DateTime.Now.AddMinutes(30),
            signingCredentials: creds);

            var tokenText = new JwtSecurityTokenHandler().WriteToken(token);

            return tokenText;
        }

    }
    
    
    
    
     public class CompanyService : ICompanyService
    {
        IUnitOfWork unitOfWork;

        public CompanyService(IUnitOfWork unitOfWork)
        {
            this.unitOfWork = unitOfWork;
        }

        public async Task<bool> AddRecruiterToCompany(Recruiter recruiter, Company company)
        {
            if (recruiter.company == null)
            {
                recruiter.company = company;
                return unitOfWork.RecruiterRepository.Update(recruiter);
            }
            else
            {
                return false;
            }
        }


        public async Task<bool> DeleteRecruiterFromCompany(int id)
        {
            var r = await unitOfWork.RecruiterRepository.GetById(id);

            var recruiter = await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(r);

            if (recruiter != null)
            {
                recruiter.company = null;

                return true;
            }
            else
            {
                return false;
            }
        }





        public async Task<bool> AddCompany(Company company)
        {
            int recruiterId = company.RecruiterIdAdmin;

            Recruiter recruiter = await unitOfWork.RecruiterRepository.GetById(recruiterId);

            recruiter = await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(recruiter);

            if (recruiter.company == null)
            {
                var added = await unitOfWork.CompanyRepository.Add(company);

                if (added)
                {
                    recruiter.company = company;

                    return true;
                }
                else
                {
                    return false;
                }
            }
            else
            {
                return false;
            }

        }

        public bool UpdateCompany(Company company)
        {
            return unitOfWork.CompanyRepository.Update(company);
        }

        public async Task<Company> GetCompanyById(int id)
        {
            var company = await unitOfWork.CompanyRepository.GetById(id);

            return company;
        }

        public async Task<Company> GetCompanyWithRelated(int id)
        {
            var c = await unitOfWork.CompanyRepository.GetById(id);
            if (c != null)
            {
                var company = await unitOfWork.CompanyRepository.GetCompanyWithRelated(c);
                return company;
            }
            else
            {
                return null;
            }

        }

        public async Task<Company> GetCompanyByName(string companyName)
        {
            var companies = await unitOfWork.CompanyRepository.FindExpression(c =>
            c.CompanyName.Equals(companyName));

            var company_ = companies.FirstOrDefault();//first or null

            return company_;
        }

        public void ChangeTrackerDetectChanges()
        {
            unitOfWork.ChangeTrackerDetectChanges();
        }

        public async Task<bool> SaveContext()
        {
            return await unitOfWork.SaveContext();
        }
    }
    
    
    
    
     public class JobService : IJobService
    {
        IUnitOfWork unitOfWork;

        public JobService(IUnitOfWork unitOfWork)
        {
            this.unitOfWork = unitOfWork;
        }

        public async Task<bool> AddJob(Job job)
        {
            job.DatePosted = DateTime.Now;

            return unitOfWork.JobRepository.AddWithRelatedEntites(job);
        }


        public async Task<IEnumerable<Job>> GetAllJobsForRecruiter(Recruiter recruiter)
        {
            var recruiter_ = await unitOfWork.RecruiterRepository.GetRecruiterWithRelativeEntity(recruiter);

            var jobs = recruiter_.jobs;

            foreach (var job in jobs)
            {
                await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, true);
            }

            return jobs;
        }


        public async Task<IEnumerable<Job>> GetAllJobsForCandidate()
        {
            var list = await unitOfWork.JobRepository.GetAll();

            foreach (var job in list)
            {
                await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, false);
            }

            return list;
        }

        public async Task<IEnumerable<Job>> GetJobsForCandidateByTitle(string jobTitle)
        {
            var list = await unitOfWork.JobRepository.FindExpression(j=> j.JobTitle.Contains(jobTitle));

            foreach (var job in list)
            {
                await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, false);
            }

            return list;
        }


        public async Task<Job> RecruiterGetJob(int id, string email)
        {
            Job job = await unitOfWork.JobRepository.GetById(id);//tuka e null realted

            if (job == null)
            {
                return null;
            }

            var jobWithRelatedEntiti = await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, true);//tuka se popolneti

            if (email.Equals(jobWithRelatedEntiti.recruiter.Email))
            {
                return jobWithRelatedEntiti;
            }
            else
            {
                return null;
            }
        }



        public bool UpdateJob(Job job, Job jobFromDatabase)
        {
            try
            {
                job.RecruiterFK = jobFromDatabase.RecruiterFK;

                job.CompanyFk = jobFromDatabase.CompanyFk;

                unitOfWork.JobRepository.Update(job);

                return true;
            }
            catch (Exception e)
            {
                return false;
            }
        }

        public async Task<Job> CandidateGetJobById(int id)
        {
            Job job = await unitOfWork.JobRepository.GetById(id);

            var jobWithRelatedEntities = await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, false);

            return jobWithRelatedEntities;
        }

        public async Task<string> CandidateAppliedForJob(int candidateid, int jobId)
        {
            Job job = await unitOfWork.JobRepository.GetById(jobId);

            Candidate candidate = await unitOfWork.CandidateRepository.GetById(candidateid);

            DateTime now = DateTime.Now;

            if (job.ActiveToDate.CompareTo(now) < 0)
            {
                return "Job expired";
            }

            if (job != null && candidate != null)
            {
                CandidateJob candidateJob = new CandidateJob { CandidateId = candidate.Id, JobId = job.Id, candidate = candidate, job = job };

                var jobWithRelated = await unitOfWork.JobRepository.GetJobWithRelatedEntities(job, true);

                //if candidate already applied for specific job
                var contained = jobWithRelated.candidates.Where((c) =>
                    {
                        return c.CandidateId.Equals(candidateJob.CandidateId);

                    }).Where(c => c.JobId.Equals(candidateJob.JobId));


                if (contained.Any())
                {
                    return "You have already applied for the job !";
                }

                job.candidates.Add(candidateJob);

                return "applied";
            }
            else
            {
                return "Candidate or Job does not exists";
            }
        }


        public void ChangeTrackerDetectChanges()
        {
            unitOfWork.ChangeTrackerDetectChanges();
        }

        public async Task<bool> SaveContext()
        {
            return await unitOfWork.SaveContext();
        }

        public bool Deatach(Job entity)
        {
            return unitOfWork.JobRepository.Deatach(entity);
        }
    }
    
    
    
    
    
    public class RecruitmentProcessService : IBaseService, IRecruitmentProcessService
    {
        IUnitOfWork unitOfWork;

        public RecruitmentProcessService(IUnitOfWork unitOfWork)
        {
            this.unitOfWork = unitOfWork;
        }

        public async Task<RecruitmentProcess> FindRecruitmentProcessByJobId(int jobId)
        {
            var recruitmentProcess = await unitOfWork.RecruitmentProcessRepository.FindRecruitmentProcessByJobId(jobId);

            return recruitmentProcess;
        }

        public async Task<RecruitmentProcess> GetRecruitmentProcessById(int id)
        {
            var recruitmentProcesses = await unitOfWork.RecruitmentProcessRepository.GetById(id);
            
            await unitOfWork.RecruitmentProcessRepository.GetRecruitmentProcessWithRelativeEntity(recruitmentProcesses);
            
            return recruitmentProcesses;
        }

        public async Task<IEnumerable<RecruitmentProcess>> GetAllRecruitmentProcessForRecruiterWithRelative(string email)
        {
            var recruitmentProcesses = await unitOfWork.RecruitmentProcessRepository.GetForRecruiter(email);

            foreach (var recruitmentProcess in recruitmentProcesses)
            {
                await unitOfWork.RecruitmentProcessRepository.GetRecruitmentProcessWithRelativeEntity(recruitmentProcess);
            }

            return recruitmentProcesses;
        }

        public async Task<bool> DeleteRecruitmentProcessCandidateJoinTable(int recruitmentProcessId)
        {
            var recruitmentProcess=await unitOfWork.RecruitmentProcessRepository.GetById(recruitmentProcessId);

           return await unitOfWork.RecruitmentProcessRepository.DeleteRecruitmentProcessCandidateJoinTable(recruitmentProcess);
        }

        public async Task<bool> DeleteRecruitmentProcessById(int recruitmentProcessId)
        {
            return await unitOfWork.RecruitmentProcessRepository.Delete(recruitmentProcessId);
        }

        public async Task<bool> AddRecruitmentProcess(RecruitmentProcess recruitmentProcess)
        {
            return await unitOfWork.RecruitmentProcessRepository.Add(recruitmentProcess);
        }

        public async Task<bool> CheckRecruitmentProcessByJobId(int jobId)
        {
            var recruitmentProcess = await unitOfWork.RecruitmentProcessRepository.FindExpression(rp => rp.job.Id.Equals(jobId));

            if (recruitmentProcess.Any())
            {
                return true;
            }
            else 
            {
                return false;
            }
        }

        public  void AddCandidatesToRecruitmentProcess(RecruitmentProcess recruitmentProcess,
            IList<CandidateJob> candidates)
        {
            foreach (var candidate in candidates)
            {
                RecruitmentProcessCandidate recruitmentProcessCandidate = new RecruitmentProcessCandidate();

                recruitmentProcessCandidate.candidate = candidate.candidate;

                recruitmentProcessCandidate.CandidateId = candidate.candidate.Id;

                recruitmentProcessCandidate.recruitmentProcess = recruitmentProcess;

                recruitmentProcessCandidate.recruitmentProcessId = recruitmentProcess.Id;   
                
                recruitmentProcess.candidates.Add(recruitmentProcessCandidate);
            }

        }

        public void ChangeTrackerDetectChanges()
        {
            unitOfWork.ChangeTrackerDetectChanges();
        }

        public async Task<bool> SaveContext()
        {
            return await unitOfWork.SaveContext();
        }
    }
    
    
    
    
    public class TabService : ITabService
    {
        IUnitOfWork unitOfWork;

        public TabService(IUnitOfWork unitOfWork)
        {
            this.unitOfWork = unitOfWork;
        }

        public async Task<bool> DeleteCandidateFromTab(TabCandidate tabCandidate)
        {
            return await unitOfWork.TabRepository.DeleteCandidateFromTab(tabCandidate);
        }

        public IList<Tab> SearchedCandidates(IList<Tab> tabs, string searchQuery)
        {
            foreach (var tab in tabs)
            {
                var searchedCandidates = tab.candidates.Where(c => c.candidate.Email.Contains(searchQuery));

                tab.candidates = searchedCandidates.ToList();
            }
            
            return tabs;
        }

        public async Task<bool> CreateTab(Tab tab)
        {
            return unitOfWork.TabRepository.AddWithRelatedEntites(tab);
        }


        public async Task<bool> DeleteTab(int tabId)
        {
            return await unitOfWork.TabRepository.Delete(tabId);
        }

        public async Task<Tab> GetTabWithRelative(Tab tab, bool includeCandidates)
        {
            return await unitOfWork.TabRepository.GetTabWithRelative(tab, includeCandidates);
        }

        public void ChangeTrackerDetectChanges()
        {
            unitOfWork.ChangeTrackerDetectChanges();
        }

        public async Task<bool> SaveContext()
        {
            return await unitOfWork.SaveContext();
        }
    }
```



<b>Controllers</b>
<br />
```
    [Route("api/[controller]")]
    [ApiController]
    public class AccountController : ControllerBase
    {
        IAccountService accountService;
        IMapper mapper;

        public AccountController(IAccountService accountService, IMapper mapper)
        {
            this.accountService = accountService;
            this.mapper = mapper;
        }


        [HttpPost("validatetoken")]
        [Authorize(AuthenticationSchemes = JwtBearerDefaults.AuthenticationScheme)]
        public IActionResult ValidateToken([FromBody] string token)
        {
            return Ok(token);
        }


        /// <summary>
        /// gets candidateDto with name email pasword age return candidateDto
        /// </summary>
        /// <param name="candidateDto"></param>
        /// <returns>candidateDto no token no review</returns>
        [HttpPost("registerCandidate")]
        public async Task<IActionResult> RegisterCandidate(CandidateDto candidateDto)
        {
            var candidate = this.mapper.Map<CandidateDto, Candidate>(candidateDto);

            await accountService.AddCandidate(candidate);

            accountService.ChangeTrackerDetectChanges();

            bool saved = await accountService.SaveContext();

            if (saved)
            {
                var candidate_Dto = this.mapper.Map<Candidate, CandidateDto>(candidate);

                return Ok(candidate_Dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }



        /// <summary>
        /// ges candidateDto with name and password and returns candidateDto without relatives with token
        /// used for login purpose
        /// </summary>
        /// <param name="candidateDto"></param>
        /// <returns>candidateDto no relative</returns>
        [HttpPost("loginCandidate")]
        public async Task<IActionResult> LoginCandidate(CandidateDto candidateDto)
        {
            var candidate = mapper.Map<CandidateDto, Candidate>(candidateDto);

            var candidate_ = await accountService.GetCandidate(candidate);

            if (candidate_ != null)
            {
                var candidate_Dto = this.mapper.Map<Candidate, CandidateDto>(candidate_);

                var token = accountService.IssueCandidateJwtToken(candidate_);

                candidate_Dto.Token = token;

                return Ok(candidate_Dto);
            }
            else
            {
                return NotFound("Candidate not found");
            }
        }




        /// <summary>
        ///  used for registration purpose
        ///  gets email fullname password
        /// </summary>
        /// <param name="recruiterDto"></param>
        /// <returns>recruiterDto or 500 error status</returns>
        [HttpPost("registerRecruiter")]
        public async Task<IActionResult> RegisterRecruiter(RecruiterDto recruiterDto)
        {
            var recruiter = this.mapper.Map<RecruiterDto, Recruiter>(recruiterDto);

            await accountService.AddRecuiter(recruiter);

            bool saved = await accountService.SaveContext();

            if (saved)
            {
                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter);

                return Ok(recruiter_dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }

        }



        /// <summary>
        /// gets recruiterDto with name and password and returns recruiterDto with related enteties and token
        /// used for login purpose
        /// </summary>
        /// <param name="recruiterDto"></param>
        /// <returns>recruiterDto or NotFound</returns>
        [HttpPost("loginRecruiter")]
        public async Task<IActionResult> LoginRecruiter(RecruiterDto recruiterDto)
        {
            var recruiter = this.mapper.Map<RecruiterDto, Recruiter>(recruiterDto);

            var recruiter_ = await accountService.GetRecuiter(recruiter);

            if (recruiter_ != null)
            {
                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter_);

                string token = "";

                if (recruiter_.company != null && recruiter_.Id.Equals(recruiter_.company.RecruiterIdAdmin))
                {
                    token = accountService.IssueRecruiterJwtToken(recruiter_, ClaimsLevel.Admin);
                }
                else
                {
                    token = accountService.IssueRecruiterJwtToken(recruiter_, ClaimsLevel.NoAdmin);
                }

                recruiter_dto.Token = token;

                return Ok(recruiter_dto);
            }
            else
            {
                return NotFound("Recruiter not found");
            }

        }


        /// <summary>
        /// finds recruier with email only using claims used in home screen
        /// </summary>
        /// <returns>RecruiterDto with relative or NotFound</returns>
        [HttpGet("getRecruiter")]
        public async Task<IActionResult> GetRecruiter()
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruiter = await accountService.GetRecuiterByEmail(email);

            if (recruiter != null)
            {
                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter);

                return Ok(recruiter_dto);
            }
            else
            {
                return NotFound("Recruiter not found");
            }
        }


        /// <summary>
        /// finds candidate with email only using claims used in home screen
        /// </summary>
        /// <returns>CandidateDto with relative</returns>
        [HttpGet("getCandidate")]
        public async Task<IActionResult> GetCandidate()
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var candidate = await accountService.GetCandidateByEmail(email);

            if (candidate != null)
            {
                var candidate_dto = this.mapper.Map<Candidate, CandidateDto>(candidate);

                return Ok(candidate_dto);
            }
            else
            {
                return NotFound("Canidate not found");
            }
        }



        /// <summary>
        /// da ne se praka so GetCandidate cvto bidejki zafaka memorija
        /// ke go zemam kandidatot so email claim type od JWT token 
        /// </summary>
        /// <returns>CV File or NotFound(cv or canidate) </returns>
        [HttpGet("CandidateGetCv")]
        public async Task<IActionResult> CandidateGetCv()
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var candidate = await accountService.GetCandidateByEmail(email);

            if (candidate != null && email.Equals(candidate.Email))
            {
                var cv = await accountService.GetCandidateCV(candidate.Cv.Id);

                if (cv != null)
                {
                    return File(cv.File, "application/pdf", cv.Name);
                }
                else
                {
                    return NotFound("Cv not found");
                }
            }
            else
            {
                return NotFound("Canidate not found");
            }
        }


        /// <summary>
        /// recruiter gets candidate cv
        /// </summary>
        /// <param name="candidateId"></param>
        /// <returns>CV File or NotFound(cv or canidate) </returns>
        [Authorize(Policy = "Recruiter")]
        [HttpGet("RecruiterGetCandidateCv/{candidateId:int}")]
        public async Task<IActionResult> RecruiterGetCandidateCv(int candidateId)
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var candidate = await accountService.GetCandidateById(candidateId);

            if (candidate != null)
            {
                if (candidate.Cv != null)
                {
                    var cv = await accountService.GetCandidateCV(candidate.Cv.Id);
                    return File(cv.File, "application/pdf", cv.Name);
                }
                else
                {
                    return NotFound("Cv not found");
                }
            }
            else
            {
                return NotFound("Canidate not found");
            }
        }






        /// <summary>
        /// gets the CV and
        /// add the Cv to candidate and if that candidiate already have Cv it deletes the first before adding new
        /// </summary>
        /// <param name="formData"></param>
        /// <returns>CV file</returns>
        [HttpPost("CV")]
        public async Task<IActionResult> CV([FromForm(Name = "body")] IFormFile formData)
        {
            if (formData.Length > 1048576)
            {
                return BadRequest("CV too big");
            }

            if (formData.FileName != null && formData.Length != null)
            {
                Byte[] bytes = null;

                using (MemoryStream ms = new MemoryStream())

                {

                    await formData.CopyToAsync(ms);

                    bytes = ms.ToArray();

                }

                var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

                var candidate = await accountService.GetCandidateByEmail(email);

                if (candidate.Cv != null)
                {
                    await accountService.DeleteCandidateCV(candidate.Cv.Id);
                }

                CV cV = new CV { Name = formData.FileName, UploadDate = DateTime.Now, File = bytes };

                candidate.Cv = cV;

                var saved = await accountService.SaveContext();

                if (saved)
                {
                    var cv = await accountService.GetCandidateCV(candidate.Cv.Id);

                    if (cv != null)
                    {
                        return File(cv.File, "application/pdf", cv.Name);
                    }
                    else
                    {
                        return NotFound("Cv not found");
                    }

                }
                else
                {
                    return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
                }
            }
            else
            {
                return BadRequest("No Cv selected");
            }
        }


        /// <summary>
        ///Edit the Candidate gets candidate name email password age in candidateDto
        /// </summary>
        /// <param name="candidateDto"></param>
        /// <returns>candidateDto without relative or 500 status error</returns>
        [HttpPost("EditCandidate")]
        public async Task<IActionResult> EditCandidate(CandidateDto candidateDto)
        {
            var candidate = this.mapper.Map<CandidateDto, Candidate>(candidateDto);

            await accountService.UpdateCandidate(candidate);

            var saved = await accountService.SaveContext();

            if (saved == true)
            {
                var candidate_dto = this.mapper.Map<Candidate, CandidateDto>(candidate);

                return Ok(candidate_dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError);
            }
        }


        /// <summary>
        ///  Not implemented
        /// </summary>
        /// <param name="email"></param>
        /// <returns></returns>
        [HttpPost("SendEmailToCandidates")]
        public async Task<IActionResult> SendEmailToCandidates(EmailDto email)
        {
            //1. install MailKit by Jeffrey Stedfast from nuget packet manager 
            //2.  var message=new MimeMessage(); //using MimeKit
            // message.From.Add(new MailoBoxAdress("name","sender email"))
            // message.To.Add(new MailoBoxAdress("name","recive email"))
            // message.Subject="This is subject"
            // message.Body=new TextPart("plain")
            //  {
            //       Text="sdsdsdds"
            //  }

            /*
             using (var client =new SmtpCleint() )//using MailKit.Net.Smtp
            {
            client.Connect("smtp_address_here", port_here, true);

            client.Authenticate("user_name_here", "pwd_here");

            client.Send(message);
            client.Disconnect(true)
            }
             
             */
            return Ok();
        }
    }







    [Route("api/[controller]")]
    [ApiController]
    public class CompanyController : ControllerBase
    {

        IMapper mapper;
        ICompanyService companyService;
        IAccountService accountService;

        public CompanyController(IMapper mapper,ICompanyService companyService,IAccountService accountService)
        {
            this.mapper = mapper;
            this.companyService = companyService;
            this.accountService = accountService;
        }


        /// <summary>
        /// creates new company and recruiter is added as admin
        /// </summary>
        /// <param name="companyDto"></param>
        /// <returns>RecruiterDto</returns>
        [HttpPost("addcompany")]
        public async Task<IActionResult> AddCompany(CompanyDto companyDto)
        {

            var company = this.mapper.Map<CompanyDto, Company>(companyDto);

           var companyExists= await companyService.GetCompanyByName(company.CompanyName);

            if (companyExists != null)
            {
                return BadRequest("Company already exists");
            }
           
           var added= await companyService.AddCompany(company);

            companyService.ChangeTrackerDetectChanges();

           var saved=await companyService.SaveContext();

            if (saved && added)
            {
                var recruiterId = companyDto.RecruiterIdAdmin;

               var recruiter=await accountService.GetRecuiterById(recruiterId);

                var token = accountService.IssueRecruiterJwtToken(recruiter, ClaimsLevel.Admin);

                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter);

                recruiter_dto.Token = token;

                return Ok(recruiter_dto);
            }
            else
            {
                var message = added ? "Failed" : "you already have company";

                return StatusCode(StatusCodes.Status500InternalServerError, message);
            }
        }


        /// <summary>
        /// validate the policy
        /// </summary>
        /// <returns>Ok when is valid acess denie when not</returns>
        [HttpGet("EditCompany")]
        [Authorize(Policy = "AdminRecruiter")]
        public IActionResult AddRecruiterToCompany()
        {
            return Ok();    
        }


        /// <summary>
        /// gets company to update
        /// </summary>
        /// <param name="companyDto"></param>
        /// <returns>RecruiterDto with company or 500 error status</returns>
        [HttpPost("EditCompany")]
        [Authorize(Policy = "AdminRecruiter")]
        public async Task<IActionResult> EditCompany(CompanyDto companyDto)
        {
            var company = this.mapper.Map<CompanyDto, Company>(companyDto);

            companyService.UpdateCompany(company);

            var saved = await companyService.SaveContext();

            if (saved)
            {
                var recruiter = await accountService.GetRecuiterById(company.RecruiterIdAdmin);

                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter);

                return Ok(recruiter_dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }



        /// <summary>
        /// gets email and company name 
        /// </summary>
        /// <param name="email"></param>
        /// <param name="companyName"></param>
        /// <returns>RecruiterDto or NotFound or BadRequest or 500 error status</returns>
        [HttpPost("AddRecruiterToCompany")]
        [Authorize(Policy = "AdminRecruiter")]
        public async Task<IActionResult> AddRecruiterToCompany([FromBody]string email,[FromQuery] string companyName)
        {
            var recruiter=await accountService.GetRecuiterByEmail(email);

            var company = await companyService.GetCompanyByName(companyName);

            if (recruiter == null)
            {
                return NotFound("Recruiter not Found");
            }
            else if (company == null)
            {
                return NotFound("Company not Found");
            }

            var added=await companyService.AddRecruiterToCompany(recruiter, company);

            if (added == false)
            {
                return BadRequest("Recruiter already added");
            }

            var saved = await companyService.SaveContext();

            if (saved)
            {
                var recruiter_dto = this.mapper.Map<Recruiter, RecruiterDto>(recruiter);

                return Ok(recruiter_dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }



        /// <summary>
        /// gets company id and returns all recruiters from company 
        /// </summary>
        /// <param name="id"></param>
        /// <returns>IEnumerable<RecruiterDto> or BadRequest</returns>
        [HttpGet("getCompanyRecruiters/{id:int}")]
        [Authorize(Policy = "AdminRecruiter")]
        public async Task<IActionResult> GetCompanyRecruiters(int id) 
        {
            var company=await companyService.GetCompanyWithRelated(id);

            if (company != null)
            {
              var recruiters=this.mapper.Map<IEnumerable<RecruiterDto>>(company.recruiters);

               return Ok(recruiters);
            }
            else 
            {
                return BadRequest("Comppany does not Exists");           
            }
        }


        /// <summary>
        /// gets id from recruiter and companyid for company and delete the recruiter id from company companyid
        /// </summary>
        /// <param name="id"></param>
        /// <param name="companyid"></param>
        /// <returns>returns the remaning recruiters</returns>
        [HttpGet("{companyid:int}/DeleteRecruiterFromCompany/{recruiterid:int}")]
        [Authorize(Policy = "AdminRecruiter")]
        public async Task<IActionResult> DeleteRecruiterFromCompany(int recruiterid, int companyid)
        {
            var deleted=await companyService.DeleteRecruiterFromCompany(recruiterid);

            if (deleted == false)
            {
                return BadRequest("Recruiter does not have a company");
            }

            var saved=await companyService.SaveContext();

            if (saved == true)
            {
                var company = await companyService.GetCompanyWithRelated(companyid);

                if (company != null)
                {
                    var recruiters = this.mapper.Map<IEnumerable<RecruiterDto>>(company.recruiters);

                    return Ok(recruiters);
                }
                else 
                {
                    return BadRequest("Comppany does not Exists");
                }      
            }
            else 
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }

        }
    }







    [Route("api/[controller]")]
    [ApiController]
    public class JobController : ControllerBase
    {
        IJobService jobService;
        IMapper mapper;

        public JobController(IJobService jobService,IMapper mapper)
        {
            this.jobService = jobService;
            this.mapper = mapper;
        }

        /// <summary>
        /// gets job with recruiter and company
        /// </summary>
        /// <param name="jobDto"></param>
        /// <returns>jobDto with recruiter and company or 500 error status</returns>
        [HttpPost("createjob")]
        public async Task<IActionResult> CreateJob(CreateJobDto jobDto)
        {
            var job=this.mapper.Map<CreateJobDto, Job>(jobDto);

            await jobService.AddJob(job);

            bool saved= await jobService.SaveContext();

            if (saved)
            {     
                var job_dto = this.mapper.Map<Job, JobDto>(job);

                return Ok(job_dto);
            }
            else 
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }

        /// <summary>
        /// gets RecruiterDto with company  only that will be mapped to fk only
        /// </summary>
        /// <param name="recruiterDto"></param>
        /// <returns>IEnumerable<JobDto> or NotFound</returns>
        [HttpPost("GetAllJobsForRecruiter")]
        public async Task<IActionResult> GetAllJobsForRecruiter(RecruiterDto recruiterDto)
        {
            var recruiter=this.mapper.Map<RecruiterDto, Recruiter>(recruiterDto);

            var jobs=await jobService.GetAllJobsForRecruiter(recruiter);

            if (jobs != null)
            {
                var job_dto = this.mapper.Map<IEnumerable<JobDto>>(jobs);

                return Ok(job_dto);
            }
            else 
            {
                return NotFound("No jobs found");
            }
        }

        /// <summary>
        /// gets jobs for candidates
        /// </summary>
        /// <returns>IEnumerable<JobDto> or NotFound</returns>
        [Authorize(Policy = "RegisteredCandidate")]
        [HttpGet("GetJobsForCandidate")]
        public async Task<IActionResult> GetJobsForCandidate([FromQuery] string jobTitle = null)
        {
            IEnumerable<Job> jobs = new List<Job>();

            if (jobTitle == null || jobTitle == "")
            {
                jobs = await jobService.GetAllJobsForCandidate();
            }
            else 
            {
                jobs = await jobService.GetJobsForCandidateByTitle(jobTitle);
            }

            if (jobs != null)
            {
                var job_dto = this.mapper.Map<IEnumerable<JobDto>>(jobs);

                return Ok(job_dto);
            }
            else
            {
                return NotFound("No jobs found");
            }
        }


        /// <summary>
        /// gets id of job checks whether it belongs to recruiter
        /// </summary>
        /// <param name="jobId"></param>
        /// <returns>Ok with JobDto or BadRequest(if job not found and not belong to that recruiter) </returns>
        [HttpGet("RecruiterGetJob/{jobId}")]
        public async Task<IActionResult> RecruiterGetJob(int jobId)
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var job = await jobService.RecruiterGetJob(jobId, email);

            if (job != null)
            {
                var jobDto=this.mapper.Map<Job, JobDto>(job);

                return Ok(jobDto);
            }
            else 
            {
                return BadRequest("your Job does not exists");
            }
        }


        /// <summary>
        /// gets JobDto no company checks whether it belongs to recruiter
        /// </summary>
        /// <param name="jobDto"></param>
        /// <returns>JobDto with company</returns>
        [HttpPost("RecruiterEditJob")]
        public async Task<IActionResult> RecruiterEditJob(JobDto jobDto) 
        {
            var job_ = this.mapper.Map<JobDto, Job>(jobDto);

            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var job = await jobService.RecruiterGetJob(job_.Id, email);
      
            jobService.Deatach(job);
            //The instance of entity type 'Job' cannot be tracked because another instance with the key value '{Id: 15}' 
            //is already being tracked.When attaching existing entities, ensure that only one entity instance 
            //with a given key value is attached.
            //You don't need to call _dbSet.Update because as the error message 
            //indicates the entity is already being tracked from your previous query.

            if (job != null)
            {         
                jobService.UpdateJob(job_,job);

                bool saved = await jobService.SaveContext();

                if (saved)
                {
                    var job_dto = this.mapper.Map<Job, JobDto>(job_);

                    return Ok(job_dto);
                }
                else
                {
                    return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
                }
            }
            else 
            {
                return BadRequest("Job is not yours");
            }
        }

        /// <summary>
        /// gets jobId and finds the job used for candidates
        /// </summary>
        /// <param name="jobId"></param>
        /// <returns>JobDto with company or NotFound</returns>
        [HttpGet("CandidateGetJob/{jobId}")]
        public async Task<IActionResult> CandidateGetJob(int jobId)
        {   
            Job job=await jobService.CandidateGetJobById(jobId);

            if (job != null)
            {
                var job_dto= this.mapper.Map<Job, JobDto>(job);

                return Ok(job_dto);

            }
            else
            {
                return NotFound("Job not found");
            }
        }


        /// <summary>
        /// gets CandidateDto and job id
        /// </summary>
        /// <param name="candidateDto"></param>
        /// <param name="jobId"></param>
        /// <returns>sucess message BadRequest</returns>
        [HttpPost("CandidateAppliedForJob/{jobId:int}")]
        public async Task<IActionResult> CandidateAppliedForJob(CandidateDto candidateDto,int jobId)
        {
            string message=await jobService.CandidateAppliedForJob(candidateDto.Id, jobId);

            if (message != "applied")
            {
                return BadRequest(message);
            }

            var saved=await jobService.SaveContext();

            if (saved)
            {
                return Ok("You have applied for the job !");
            }
            else
            {
                return BadRequest("Failed");
            }
        }
    }






    [Route("api/[controller]")]
    [ApiController]
    public class RecruitmentProcessController : ControllerBase
    {
        IAccountService accountService;
        IJobService jobService;
        IRecruitmentProcessService recruitmentProcessService;
        ITabService tabService;
        IMapper mapper;

        public RecruitmentProcessController(ITabService tabService, IRecruitmentProcessService recruitmentProcessService, IJobService jobService, IAccountService accountService, IMapper mapper)
        {
            this.accountService = accountService;
            this.tabService = tabService;
            this.jobService = jobService;
            this.recruitmentProcessService = recruitmentProcessService;
            this.mapper = mapper;
        }


        /// <summary>
        /// checks if recruitment Process exists checks if canidaite exists in recruitment Process checks if tab exists
        /// deletes candidates from Prev tab adds them in next
        /// </summary>
        /// <param name="ids">candidates ids to add to next tab</param>
        /// <param name="recruitmentProcessId"></param>
        /// <param name="tabId">next tab</param>
        /// <returns>empty Ok, Bad Request and 500</returns>
        [HttpPost("NextStepCandidate/{recruitmentProcessId:int}/{tabId:int}")]
        public async Task<IActionResult> NextStepCandidate(List<int> ids, int recruitmentProcessId, int tabId)
        {
            bool error = false;

            foreach (var id in ids)
            {
                var recruitmentProcess = await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessId);

                if (recruitmentProcess == null)
                {
                    return NotFound("Recruitment Process not found");
                }

                var recruitmentProcessCandidate = recruitmentProcess.candidates.Where(c => c.CandidateId.Equals(id)).FirstOrDefault();

                if (recruitmentProcessCandidate == null)
                {
                    return BadRequest("Candidate does not have Recruitment Process for this job " + recruitmentProcess.job.JobTitle);
                }

                var candidate = recruitmentProcessCandidate.candidate;

                var tab = recruitmentProcess.tabs.Where(t => t.Id.Equals(tabId)).FirstOrDefault();

                if (tab == null)
                {
                    return NotFound("Tab not found");
                }
                
                var list =recruitmentProcess.tabs.OrderBy(t => t.Id).ToList();
                
                var index= list.IndexOf(tab,0);

                IList<TabCandidate> deleteList = new List<TabCandidate>();

                // za ptvoto index e 1 i 1-1 > 0 ke bide false nema da gi brise od predhodniot tab
                //sekogas ke pocne od 1 bidejki next tab ke bide 1
                //ako ne postoi tab return NotFound("Tab not found");
                if (index - 1 > 0)
                {
                    var prevTab = list[index - 1];

                    await tabService.GetTabWithRelative(prevTab,true);

                    //izbrisi go od ednoto stavi go vo drugoto
                    foreach (var candidateToDelete in prevTab.candidates.Where(c=>c.candidate.Id.Equals(candidate.Id)))
                    {
                        deleteList.Add(candidateToDelete);
                    }
                }

                foreach (var tabCandidate in deleteList)
                {
                    await tabService.DeleteCandidateFromTab(tabCandidate);
                }

                TabCandidate tabCandidateAdd = new TabCandidate();

                tabCandidateAdd.candidate = candidate;

                tabCandidateAdd.CandidateId = candidate.Id;

                tabCandidateAdd.tab = tab;

                tabCandidateAdd.TabId = tab.Id;

                tab.candidates.Add(tabCandidateAdd);
         
                var saved = await accountService.SaveContext();

                if (saved == false)
                {
                    error = true;
                    break;
                }
            }

            if (error)
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
            else
            {
                return Ok();
            }
        }


        /// <summary>
        /// 
        /// </summary>
        /// <param name="ids"></param>
        /// <param name="recruitmentProcessId"></param>
        /// <param name="tabId"></param>
        /// <returns></returns>
        [HttpPost("BackStepCandidate/{recruitmentProcessId:int}/{tabId:int}")]
        public async Task<IActionResult> BackStepCandidate(List<int> ids, int recruitmentProcessId, int tabId)
        {
            bool error = false;

            foreach (var id in ids)
            {
                var recruitmentProcess = await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessId);

                if (recruitmentProcess == null)
                {
                    return NotFound("Recruitment Process not found");
                }

                var recruitmentProcessCandidate = recruitmentProcess.candidates.Where(c => c.CandidateId.Equals(id)).FirstOrDefault();

                if (recruitmentProcessCandidate == null)
                {
                    return BadRequest("Candidate does not have Recruitment Process for this job " + recruitmentProcess.job.JobTitle);
                }

                var candidate = recruitmentProcessCandidate.candidate;

                var tab = recruitmentProcess.tabs.Where(t => t.Id.Equals(tabId)).FirstOrDefault();

                if (tab == null)
                {
                    return NotFound("Tab not found");
                }
                var list = recruitmentProcess.tabs.OrderBy(t => t.Id).ToList();

                var index = list.IndexOf(tab, 0);

                IList<TabCandidate> deleteList = new List<TabCandidate>();

                if (index - 1 >= 0)
                {
                    var nextTab = list[index + 1];

                    //izbrisi go od ednoto stavi go vo drugoto

                    await tabService.GetTabWithRelative(nextTab, true);

                    foreach (var candidateToDelete in nextTab.candidates.Where(c => c.candidate.Id.Equals(candidate.Id)))
                    {
                        deleteList.Add(candidateToDelete);

                    }

                    TabCandidate tabCandidateAdd = new TabCandidate();
                    tabCandidateAdd.candidate = candidate;
                    tabCandidateAdd.CandidateId = candidate.Id;
                    tabCandidateAdd.tab = tab;
                    tabCandidateAdd.TabId = tab.Id;
                    tab.candidates.Add(tabCandidateAdd);
                }
                else if (index - 1 == -1)
                {
                    var nextTab = list[index + 1];

                    //izbrisi go od ednoto stavi go vo drugoto

                    await tabService.GetTabWithRelative(nextTab, true);

                    foreach (var candidateToDelete in nextTab.candidates.Where(c => c.candidate.Id.Equals(candidate.Id)))
                    {
                        deleteList.Add(candidateToDelete);

                    }
                }
                else
                {
                    return Ok();
                }

                foreach (var tabcan in deleteList)
                {
                    await tabService.DeleteCandidateFromTab(tabcan);
                }                 
                 var saved = await accountService.SaveContext();

                if (saved == false)
                {
                    error = true;
                    break;
                }
            }

            if (error)
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
            else
            {
                return Ok();
            }
        }


        /// <summary>
        /// deletes Recruitment Process Candidate JoinTable and RecruitmentProcess for specific recruiter
        /// </summary>
        /// <returns>the rest of RecruitmentProcesses RecruitmentProcessDto or 500 status error</returns>
        [HttpDelete("DeleteRecruitmentProcess/{recruitmentProcessId:int}")]
        public async Task<IActionResult> DeleteRecruitmentProcess(int recruitmentProcessId)
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruitmentProcess_ = await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessId);

            if (recruitmentProcess_ == null)
            {
                return BadRequest("Recruitment Process not found");
            }

            //check if it belongs to that recruiter
            if (recruitmentProcess_.job.recruiter.Email.Equals(email) == false)
            {
                return NotFound("You do not have Recruitment Process");
            }

            var deletedJoinTable = await recruitmentProcessService.DeleteRecruitmentProcessCandidateJoinTable(recruitmentProcessId);

            var savedDeletedJoinTable = await recruitmentProcessService.SaveContext();

            var deletedRecruitmentProcess = await recruitmentProcessService.DeleteRecruitmentProcessById(recruitmentProcessId);

            var savedDeletedRecruitmentProcess = await recruitmentProcessService.SaveContext();

            if (savedDeletedJoinTable && savedDeletedRecruitmentProcess)
            {
                var recruitmentProcess = await recruitmentProcessService.GetAllRecruitmentProcessForRecruiterWithRelative(email);

                var recruitmentProcess_dto = mapper.Map<IEnumerable<RecruitmentProcessDto>>(recruitmentProcess);

                return Ok(recruitmentProcess_dto);
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }


        /// <summary>
        /// gets recruitmentProcessId and returns RecruitmentProcessDto for specific recruiter
        /// </summary>
        /// <param name="recruitmentProcessId"></param>
        /// <returns></returns>
        [HttpGet("GetRecruitmentProcessById/{recruitmentProcessId:int}")]
        public async Task<IActionResult> GetRecruitmentProcessByJobId(int recruitmentProcessId)
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruitmentProcess = await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessId);

            if (recruitmentProcess == null)
            {
                return BadRequest("Recruitment Process not found");
            }
            else 
            {
                //check if it belongs to that recruiter
                if (recruitmentProcess.job.recruiter.Email.Equals(email) == false)
                {
                    return NotFound("You do not have Recruitment Process");
                }

                var recruitmentProcess_dto = this.mapper.Map<RecruitmentProcess, RecruitmentProcessDto>(recruitmentProcess);

                return Ok(recruitmentProcess_dto);
            }
        }





        /// <summary>
        /// returns all Recruitment Processes for specific recruiter
        /// </summary>
        /// <returns>RecruitmentProcessDto</returns>
        [HttpGet("GetAllRecruitmentProcess")]
        public async Task<IActionResult> GetAllRecruitmentProcess()
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruitmentProcess = await recruitmentProcessService.GetAllRecruitmentProcessForRecruiterWithRelative(email);

            if (recruitmentProcess.Any())
            {
                var recruitmentProcess_dto = mapper.Map<IEnumerable<RecruitmentProcessDto>>(recruitmentProcess);

                return Ok(recruitmentProcess_dto);
            }
            else
            {
                return NotFound("No Recruitment Processes found");
            }
        }


        /// <summary>
        /// gets recruitmentProcessesId and returns candiate  from Recruitment Process  for specific recruiter
        /// </summary>
        /// <param name="jobId"></param>
        /// <returns>IEnumerable<CandidateDto></returns>
        [HttpGet("GetCandidatesForRecruitmentProcess/{recruitmentProcessesId:int}")]
        public async Task<IActionResult> GetCandidatesForRecruitmentProcess(int recruitmentProcessesId,[FromQuery] string searchQuery=null)
        {
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;
           
            var recruitmentProcesses=await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessesId);

            if (recruitmentProcesses == null)
            {
                return NotFound("Recruitment Process not found");
            }

            //check if it belongs to that recruiter
            if (recruitmentProcesses.job.recruiter.Email.Equals(email) == false)
            {
                return NotFound("You do not have Recruitment Process");
            }

            IList<Candidate> candidates = new List<Candidate>();

            foreach (var candidate in recruitmentProcesses.candidates)
            {
                candidates.Add(candidate.candidate);
            }

            if (searchQuery != null && searchQuery!="")
            {
               var searchedCandidates= candidates.Where(c => c.Email.Contains(searchQuery));

                var searchedCandidates_dto = mapper.Map<IEnumerable<CandidateDto>>(searchedCandidates);

                return Ok(searchedCandidates_dto);
            }

             var candidates_dto = mapper.Map<IEnumerable<CandidateDto>>(candidates);

            return Ok(candidates_dto);
        }


        /// <summary>
        /// creates Recruitment Processes for job,only one R P for Job is allowed and returns recruitmentProcess Id
        /// </summary>
        /// <param name="jobId"></param>
        /// <returns>empty Ok with recruitmentProcess Id or 500 server error or Bad requsts</returns>
        [HttpGet("StartRecruitmentProcessForJob/{jobId:int}")]
        public async Task<IActionResult> StartRecruitmentProcessForJob(int jobId)
        {

            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var job = await jobService.RecruiterGetJob(jobId, email);

            if (job == null)
            {
                return BadRequest("Job not found");
            }

            var alreadyExistsRecruitmentProcessForJob = await recruitmentProcessService.CheckRecruitmentProcessByJobId(job.Id);

            if (alreadyExistsRecruitmentProcessForJob)
            {
                return BadRequest("Recruitment Process for Job already Exists");
            }

            var candidates = job.candidates;

            if (candidates.Count == 0)
            {
                return BadRequest("No candidates in job");
            }

            RecruitmentProcess recruitmentProcess = new RecruitmentProcess();

            recruitmentProcess.job = job;

            var addedRecruitmentProcess = await recruitmentProcessService.AddRecruitmentProcess(recruitmentProcess);

            var savedRecruitmentProcess = await recruitmentProcessService.SaveContext();

            recruitmentProcessService.AddCandidatesToRecruitmentProcess(recruitmentProcess, candidates);

            var savedAddCandidatesToRecruitmentProcess = await recruitmentProcessService.SaveContext();

            if (addedRecruitmentProcess & savedRecruitmentProcess && savedAddCandidatesToRecruitmentProcess)
            {         
                    return Ok(recruitmentProcess.Id);
       
            }
            else
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed ");
            }
        }
    }



    [Route("api/[controller]")]
    [ApiController]
    public class TabController : ControllerBase
    {
        ITabService tabService;
        IRecruitmentProcessService recruitmentProcessService;
        IMapper mapper;

        public TabController(ITabService tabService, IMapper mapper,IRecruitmentProcessService recruitmentProcessService)
        {
            this.tabService=tabService;
            this.recruitmentProcessService = recruitmentProcessService;
            this.mapper = mapper;
        }

        /// <summary>
        /// for others tabs not the first one
        /// </summary>
        /// <param name="recruitmentProcessId"></param>
        /// <param name="searchQuery"></param>
        /// <returns>tabs or candidates whether is searched or not</returns>
        [HttpGet("GetTabsForRecruitmentProcess/{recruitmentProcessId:int}")]
        public async Task<IActionResult> GetTabsForRecruitmentProcess(int recruitmentProcessId,
            [FromQuery] string searchQuery=null)
        { 
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruitmentProcess = await recruitmentProcessService.GetRecruitmentProcessById(recruitmentProcessId);

            if (recruitmentProcess == null)
            {
                return BadRequest("Recruitment Process not found");
            }

            //check if it belongs to that recruiter
            if (recruitmentProcess.job.recruiter.Email.Equals(email) == false)
            {
                return NotFound("You do not have Recruitment Process");
            }

            IList<Tab> tabs = new List<Tab>();

            foreach (var tab in recruitmentProcess.tabs)
            {
               Tab tab_= await tabService.GetTabWithRelative(tab, true);

                tabs.Add(tab_);
            }

            if (searchQuery != null && searchQuery != "")
            {

               var searchedTabs =tabService.SearchedCandidates(tabs,searchQuery);

                var searchedCandidates_dto = mapper.Map<IEnumerable<TabDto>>(searchedTabs);

                return Ok(searchedCandidates_dto);
            }

            var tabs_dtos = this.mapper.Map<IEnumerable<TabDto>>(tabs);

            // tabs_dtos=tabs_dtos.OrderByDescending(t => t.Id).ToList();//Sorts the elements of a sequence in Descending order.

            tabs_dtos = tabs_dtos.OrderBy(t => t.Id).ToList();//Sorts the elements of a sequence in ascending order.                                                  

            return Ok(tabs_dtos);       
        }

        /// <summary>
        /// gets  TabDto with Fk for recruitment Process checks if recruitment  Process belongs to recruiter
        /// checks if recruitment Process  exists checks if tabs have same name shich is not allowed
        /// and adds the tab
        /// </summary>
        /// <param name="tabDto"></param>
        /// <returns>added TabDto or Failed 500 status code</returns>
        [HttpPost("CreateTab")]
        public async Task<IActionResult> CreateTab(TabDto tabDto) 
        {
            var tab = this.mapper.Map<TabDto, Tab>(tabDto);
            
            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;
            
            var recruitmentProcess_ = await recruitmentProcessService.GetRecruitmentProcessById(tab.RecruitmentProcessFk);

            if (recruitmentProcess_ == null)
            {
                return BadRequest("Recruitment Process not found");
            }

            //check if it belongs to that recruiter
            if (recruitmentProcess_.job.recruiter.Email.Equals(email) == false)
            {
                return NotFound("You do not have Recruitment Process");
            }

            if (recruitmentProcess_.tabs.Where(t => t.TabName.Equals(tabDto.TabName)).Any() == true)
            {
                return NotFound("Can not do tabs with same name try adding numbers after the Tab Name");
            }

            await tabService.CreateTab(tab);

            var saved = await tabService.SaveContext();

            if (saved)
            {
               var tab_=await tabService.GetTabWithRelative(tab, false);

                var tab_dto = this.mapper.Map<Tab, TabDto>(tab_);
              
                return Ok(tab_dto);
            }
            else 
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed"); 
            }
        }


        /// <summary>
        ///   /// checks if recruitment Process  exists 
        /// checks if recruitment  Process belongs to recruiter
        /// </summary>
        /// <param name="tabDto"></param>
        /// <returns>Ok BadRequest NotFound 500 error status</returns>
        [HttpPost("DeleteTab")]
        public async Task<IActionResult> DeleteTab(TabDto tabDto)
        {
            var tab = this.mapper.Map<TabDto, Tab>(tabDto);

            var email = User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Email).Value;

            var recruitmentProcess_ = await recruitmentProcessService.GetRecruitmentProcessById(tab.RecruitmentProcessFk);

            if (recruitmentProcess_ == null)
            {
                return BadRequest("Recruitment Process not found");
            }

            //check if it belongs to that recruiter
            if (recruitmentProcess_.job.recruiter.Email.Equals(email) == false)
            {
                return NotFound("You do not have Recruitment Process");
            }

            await tabService.DeleteTab(tabDto.Id);

            var saved = await tabService.SaveContext();

            if (saved)
            {
                return Ok();
            }
            else 
            {
                return StatusCode(StatusCodes.Status500InternalServerError, "Failed");
            }
        }
    }



```





<b>AutoMapperProfiles</b>
<br />
```
       public class CandidateJobProfile:Profile
       {
           public CandidateJobProfile()
           {

            CreateMap<CandidateJob, CandidateDto>()
                .ForMember(dest => dest.Age, opt => opt.MapFrom(src => src.candidate.Age))
                .ForMember(dest => dest.Email, opt => opt.MapFrom(src => src.candidate.Email))
                .ForMember(dest => dest.FullName, opt => opt.MapFrom(src => src.candidate.FullName))
                .ForMember(dest => dest.Id, opt => opt.MapFrom(src => src.candidate.Id))
                .ForMember(dest => dest.Password, opt => opt.MapFrom(src => src.candidate.Password)).ReverseMap();


            CreateMap<CandidateJob, JobDto>()
                .ForMember(dest => dest.Id, opt => opt.MapFrom(src => src.job.Id))
                .ForMember(dest => dest.JobTitle, opt => opt.MapFrom(src => src.job.JobTitle))
                .ForMember(dest => dest.JobDescriptions, opt => opt.MapFrom(src => src.job.JobDescriptions))
                .ForMember(dest => dest.ActiveToDate, opt => opt.MapFrom(src => src.job.ActiveToDate)).ReverseMap();
            }
        }



      public class CandidateProfile:Profile
      {
          public CandidateProfile()
          {
            CreateMap<CandidateDto, Candidate>().ReverseMap();
         }
      }



        public class CompanyProfile : Profile
        {
            public CompanyProfile()
            {
          
               CreateMap<CompanyDto, Company>()
                   .ReverseMap();
            }
        }


        public class CreateJobProfile : Profile
        {
            public CreateJobProfile()
            {
                 CreateMap<CreateJobDto, Job>()
                      .ForMember(dest => dest.company, opt => opt.MapFrom(src => src.companyDto))
                      .ForMember(dest => dest.CompanyFk, opt => opt.MapFrom(src => src.companyDto.Id))
                      .ForMember(dest => dest.recruiter, opt => opt.MapFrom(src => src.RecruiterDto))
                      .ForMember(dest => dest.RecruiterFK, opt => opt.MapFrom(src => src.RecruiterDto.Id));
            }
        }

        public class JobProfile:Profile
         {
             public JobProfile()
             {         
                  CreateMap<Job, JobDto>()
                      .ForMember(dest => dest.CompanyDto, opt => opt.MapFrom(src => src.company))
                      .ForMember(dest => dest.RecruiterName, opt => opt.MapFrom(src => src.recruiter.FullName))
                      .ForMember(dest => dest.candidatesDtos, opt => opt.MapFrom(src => src.candidates))
                      .ReverseMap();          
             }
        }


       public class RecruiterProfile:Profile
       {      
        public RecruiterProfile()
        {
            // mapiram samo fk bidejki  drugite ke pravat cicrcular dependence         
            //When attaching existing entities, ensure that only one entity instance 
            //with a given key value is attached.
            //dodeka za nazad nema potreba

            CreateMap<RecruiterDto, Recruiter>()
                .ForMember(dest => dest.CompanyFK, opt => opt.MapFrom(src => src.companyDto.Id))
                .ForMember(dest => dest.jobs, opt => opt.MapFrom(src => src.jobsDto));

            CreateMap<Recruiter, RecruiterDto>()
                .ForMember(dest => dest.companyDto, opt => opt.MapFrom(src => src.company))
                .ForMember(dest => dest.jobsDto, opt => opt.MapFrom(src => src.jobs));
        }
    }





     public class RecruitmentProcessProfile:Profile
     {
        public RecruitmentProcessProfile()
        {
            CreateMap<RecruitmentProcess, RecruitmentProcessDto>()
               .ForMember(dest => dest.jobDto, opt => opt.MapFrom(src => src.job))
                //Job->JobDto
               .ForMember(dest => dest.candidatesDtos, opt => opt.MapFrom(src => src.candidates))
                //  RecruitmentProcessCandidate->RecruitmentProcessCandidateDto
               .ReverseMap();

            CreateMap<RecruitmentProcessCandidate, RecruitmentProcessCandidateDto>()
                 .ForMember(dest => dest.candidateDto, opt => opt.MapFrom(src => src.candidate))
                 //Candidate -> CandidateDto
                 .ReverseMap();

            CreateMap<RecruitmentProcess, RecruitmentProcessNoRelativeDto>()
              .ForMember(dest => dest.Id, opt => opt.MapFrom(src => src.Id))
              //RecruitmentProcess id -> RecruitmentProcessNoRelativeDto id
              .ReverseMap();
        }
    }



        public class TabProfile:Profile
        {
            public TabProfile()
            {
            CreateMap<Tab, TabDto>()
                .ForMember(dest => dest.recruitmentProcessNoRelative, opt => opt.MapFrom(src => src.recruitmentProcess))
                //RecruitmentProcess -> RecruitmentProcessNoRelativeDto
                .ForMember(dest => dest.candidatesDto, opt => opt.MapFrom(src => src.candidates));
                 // TabCandidate -> TabCandidateDto           
            
            CreateMap<TabDto, Tab>()
                .ForMember(dest => dest.RecruitmentProcessFk, opt => opt.MapFrom(src => src.recruitmentProcessNoRelative.Id));
           
            CreateMap<TabCandidate, TabCandidateDto>()
                .ForMember(dest => dest.tabDto, opt => opt.MapFrom(src => src.tab))
                //Tab -> TabDto
                .ForMember(dest => dest.candidateDto, opt => opt.MapFrom(src => src.candidate))
                .ReverseMap();
                //Candidate -> CandidateDto
            }
        }


```



<b>Entities</b>
<br />
```
    [Table("Candidates")]
    public class Candidate
    {

        [Key]
        public int Id { get; set; }

        [Required]
        public string FullName { get; set; }

        [Required]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }

        public int Age { get; set; }

        public int? CvId { get; set; }

        [ForeignKey("CvId")]
        public CV Cv { get; set; }

        public IList<Review> reviews { get; set; }
        public IList<CandidateJob> jobs { get; set; }
        public IList<RecruitmentProcessCandidate> recruitmentProcesses { get; set; }
        public IList<TabCandidate> tabs { get; set; }
    }



    [Table("CandidateJob")]
    public class CandidateJob
    {
        public int CandidateId { get; set; }

        public Candidate candidate { get; set; }

        public int JobId { get; set; }

        public Job job { get; set; }
    }



    [Table("Companies")]
    public class Company
    {
        [Key]
        public int Id { get; set; }

        [Required]
        public string CompanyName { get; set; }

        [Required]
        public string Adress { get; set; }

        [Required]
        public string City { get; set; }

        [Required]
        public string Country { get; set; }

        public int RecruiterIdAdmin { get; set; }

        public IList<Recruiter> recruiters { get; set; }
        public IList<Job> jobs{ get; set; }
        public IList<Review> reviews { get; set; }
    }




    [Table("Cv")]
    public class CV
    {
        [Key]
        public int Id { get; set; }

        [Required]
        public string Name { get; set; }

        [Required]
        public byte[] File { get; set; }

        [Required]
        public DateTime UploadDate { get; set; }

        public Candidate candidate { get; set; }
    }


    [Table("Jobs")]
    public class Job
    {
        [Key]
        public int Id { get; set; }

        [Required]
        public string JobTitle { get; set; }

        [Required]
        public DateTime DatePosted { get; set; }

        public DateTime ActiveToDate { get; set; }

        [Required]
        public string JobDescriptions { get; set; }

        [ForeignKey("RecruiterFK")]
        public Recruiter recruiter { get; set; }

        public int RecruiterFK { get; set; }

        [ForeignKey("CompanyFk")]
        public Company company{ get; set; }

        public int CompanyFk { get; set; }

        public IList<CandidateJob> candidates { get; set; }

        public Job()
        {
            this.candidates = new List<CandidateJob>();
        }

    }



    [Table("Recruiters")]
    public class Recruiter
    {

        [Key]
        public int Id { get; set; }

        [Required]
        public string FullName { get; set; }

        [Required]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }

        [ForeignKey("CompanyFK")]
        public Company company { get; set; }

        public int? CompanyFK { get; set; }

        public IList<Job> jobs { get; set; }
    }



    [Table("RecruitmentProcess")]
    public class RecruitmentProcess
    {
        [Key]
        public int Id { get; set; }

        public IList<RecruitmentProcessCandidate> candidates { get; set; }

        [ForeignKey("JobFk")]
        public Job job { get; set; }

        public int JobFk { get; set; }

        public IList<Tab> tabs { get; set; }

        public RecruitmentProcess()
        {
            candidates = new List<RecruitmentProcessCandidate>();
            tabs = new List<Tab>();
        }

    }


      public class RecruitmentProcessCandidate
    {
        public int CandidateId { get; set; }
        public Candidate candidate { get; set; }
        public int recruitmentProcessId { get; set; }
        public RecruitmentProcess recruitmentProcess { get; set; }
    }




    [Table("Reviews")]
    public class Review
    {
        public int rating { get; set; }
        public string comments { get; set; }

        public Candidate Candidate { get; set; }
        public int CandidateId { get; set; }

        public Company Company { get; set; }
        public int CompanyId { get; set; }

    }


    [Table("Tabs")]
    public class Tab
    {
        [Key]
        public int Id { get; set; }

        public string TabName { get; set; }

        public IList<TabCandidate> candidates { get; set; }

        [ForeignKey("RecruitmentProcessFk")]
        public RecruitmentProcess recruitmentProcess { get; set; }

        public int RecruitmentProcessFk { get; set; }

        public Tab()
        {
            candidates = new List<TabCandidate>();
        }

    }
    
    [Table("TabCandidate")]
    public class TabCandidate
    {
        public int TabId { get; set; }
        public Tab tab { get; set; }
        public int CandidateId { get; set; }
        public Candidate candidate { get; set; }
    }



```




<b>HelperClasses</b>
<br />
```
   public enum ClaimsLevel
    {
         NoAdmin, Admin
    }
```



<b>Models</b>
<br />
```
     public class CandidateDto
      {
        public int Id { get; set; }
      
        public string FullName { get; set; }

        [Required]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }

        public int Age { get; set; }

        public string Token { get; set; }
        
        public IEnumerable<ReviewDto> reviews { get; set; }
      }
    
     public class CompanyDto
     {
        public int Id { get; set; }

        [Required]
        public string CompanyName { get; set; }

        [Required]
        public string Adress { get; set; }

        [Required]
        public string City { get; set; }

        [Required]
        public string Country { get; set; }

        public int RecruiterIdAdmin { get; set; }

        public IEnumerable<ReviewDto> reviewsDto { get; set; }
      }

      public class CreateJobDto
       {
        public int Id { get; set; }

        [Required]
        public string JobTitle { get; set; }

        [Required]
        public DateTime DatePosted { get; set; }

        public DateTime ActiveToDate { get; set; }

        [Required]
        public string JobDescriptions { get; set; }

        public CompanyDto companyDto { get; set; }

        public RecruiterDto RecruiterDto { get; set; }
    }


     public class EmailDto
     {
        public IList<string> Ids { get; set; }

        public string Subject { get; set; }

        public string Message { get; set; }

        public EmailDto()
        {
            Ids = new List<string>();
        }

     }


     public class JobDto
     {
        public int Id { get; set; }

        [Required]
        public string JobTitle { get; set; }

        [Required]
        public DateTime DatePosted { get; set; }

        public DateTime ActiveToDate { get; set; }
        [Required]
        public string JobDescriptions { get; set; }

        public CompanyDto CompanyDto { get; set; }

        public string RecruiterName { get; set; }

        public IList<CandidateDto> candidatesDtos { get; set; }
     }



     public class RecruiterDto
     {
        public int Id { get; set; }

        public string FullName { get; set; }

        [Required]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }
       
        public string Token { get; set; }

        public CompanyDto companyDto { get; set; }

        public IEnumerable<JobDto> jobsDto { get; set; }
    }


     public class RecruitmentProcessCandidateDto
    {
        public int RecruitmentProcesLevel { get; set; }

        public CandidateDto candidateDto { get; set; }
    }

    public class RecruitmentProcessDto
    {
        public int Id { get; set; }

        public JobDto jobDto { get; set; }

        public IEnumerable<RecruitmentProcessCandidateDto> candidatesDtos{ get; set; }
    }


     public class RecruitmentProcessNoRelativeDto
     {
        public int Id { get; set; }
    }


     public class ReviewDto
     {
        public int rating { get; set; }

        public string comments { get; set; }

        public CandidateDto candidateDto { get; set; }

        public CompanyDto companyDto { get; set; }  
    }


     public class TabCandidateDto
    {
        public TabDto tabDto { get; set; }

        public CandidateDto candidateDto { get; set; }
    }


     public class TabDto
      {
        public int Id { get; set; }

        [Required]
        public string TabName { get; set; }

        public IList<TabCandidateDto> candidatesDto { get; set; }

        public RecruitmentProcessNoRelativeDto recruitmentProcessNoRelative { get; set; }
     }
```



<b>appsettings.Development.json</b>
<br />
```
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Information",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },


  "ConnectionStrings": {
    "conn": "something"
  },  

  "Security": {
    "Tokens": {
      "Issuer": "something",
      "Audience": "something",
      "Key": "something"
    }
  }

}

```
<b>appsettings.Serilog.json</b>
<br />
```
{
  "Serilog": {
    "Using": [],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning",
        "Microsoft.EntityFrameworkCore.Database.Command": "Information"
      }
    },
    "WriteTo": [
      {
        "Name": "Console"
      }
    ]

  }
}
```


<h2>Angular</h2>
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/angular.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/angular 1.jpg">
<br />
<img src="https://github.com/Alek08/RecruitAndManage/blob/master/images/angular 2.jpg">
<br />


<h2>Implementation</h2>
<br />
I will not show all Angular implementation but show just the Controller and Html file of the most complicated Component and that Component is about Recruitment Process. 
<br />
<br />
<br />
<b>Controller file</b>
<br />

```
import { AfterViewInit, Component, OnChanges, OnInit, SimpleChanges } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { Candidate } from 'src/app/Models/Candidate';
import { RecruitmentProcessService } from 'src/app/Services/Repositories/recruitment-process.service';
import { ViewChild, ElementRef } from '@angular/core';
import { TabService } from '../../../Services/Repositories/tab.service'
import { Tab } from 'src/app/Models/Tab';
import { CandidateForCheckBox } from 'src/app/Models/CandidateForCheckBox';
import { RecruitmentProcess } from 'src/app/Models/RecruitmentProcess';
import { RecruitmentProcessNoRelative } from 'src/app/Models/RecruitmentProcessNoRelative';
import { RecruiterService } from 'src/app/Services/Repositories/recruiter.service';
import { FormValidationService } from 'src/app/Services/form-validation.service';
import { NgForm } from '@angular/forms';


declare var $: any;
@Component({
  selector: 'app-show-recruitment-process',
  templateUrl: './show-recruitment-process.component.html',
  styleUrls: ['./show-recruitment-process.component.css']
})
export class ShowRecruitmentProcessComponent implements OnInit, AfterViewInit {

  public recruitmentProcessId;
  public restError;
  public existError;
  public tabs: Array<Tab>;
  public candidates: Array<Candidate>;
  public stepNumber;
  public currentTabName: string;
  public checkbox: Array<number>
  public recruitmentProcess: RecruitmentProcess;
  public firstTabAllCandidates: boolean;
  public currentTabCandidates: Array<CandidateForCheckBox>;
  public isViewCv: boolean;
  public isSendEmailAction: boolean;
  public isViewCandidate: boolean;
  public pdfSrc;
  public errorForm;
  public emails: string;
  public searchQuery: string;
  public isCheckAll: boolean;
  public currentCandidate: Candidate

  @ViewChild('progressBar') progress: ElementRef;
  @ViewChild('firstTabCandidatesDOM') firstTabCandidatesDOM: ElementRef;
  @ViewChild('NotfirstTabCandidatesDOM') NotfirstTabCandidatesDOM: ElementRef;

  constructor(private activeRoute: ActivatedRoute,
    private recruitmentProcessService: RecruitmentProcessService,
    private tabService: TabService,
    private recruiterService: RecruiterService,
    private validationService: FormValidationService) {
    this.tabs = new Array<Tab>();
    this.checkbox = new Array<number>();
    this.stepNumber = 0;
    this.existError = false;
    this.firstTabAllCandidates = false;
    this.emails = "";
    this.isViewCandidate = true
    this.isSendEmailAction = false;
    this.isViewCv = false;
    this.searchQuery = '';
    this.isCheckAll = false;
  }


  public searchCandidates(searchQuery: string): void {
    this.searchQuery = searchQuery;
    this.recruitmentProcessService.getCandidatesForRecruitmentProcess(this.recruitmentProcessId, searchQuery)
      .subscribe(
        (data: Array<Candidate>) => {
          console.log("GetCandidatesForRecruitmentProcess")
          console.log(data)
          this.candidates = data;
        }, (err) => {
          this.restError = err.error;
          $('#ErrorModal').modal('show');
        })


    this.tabService.getTabsForRecruitmentProcess(this.recruitmentProcessId, searchQuery)
      .subscribe((data: Array<Tab>) => {
        console.log("GetTabsForRecruitmentProcess")
        console.log(data)
        this.tabs = data;
        this.tabClicked(this.currentTabName)
      }, (err) => {
        console.log("TAB ERROR")
      })
  }


  public getActionClass(actionName: string): any {
    let clicked;

    if (this.isViewCandidate === true) {
      clicked = 'Candiate';
    }
    else if (this.isSendEmailAction === true) {
      clicked = 'Send Email';
    }
    else if (this.isViewCv === true) {
      clicked = 'View CV';
    }

    if (clicked === actionName) {
      return {
        active: true
      };
    }
    else {
      return
      {
        active: false
      };
    }
  }


  public labelClick(input: HTMLInputElement) {
    input.click()
  }


  public labelClickFocus(input: HTMLInputElement) {
    input.focus();
  }


  selectAllCheckboxClicked() {
    if (this.isCheckAll === true) {
      this.isCheckAll = false;
    } else {
      this.isCheckAll = true;
    }

    if (this.firstTabAllCandidates === true) {
      if (this.isCheckAll === true) {
        let nodeList = this.firstTabCandidatesDOM.nativeElement.querySelectorAll('input');

        for (let i = 0; i < nodeList.length; i++) {
          let checked = nodeList[i].getAttribute("checked");
          //na select na site sto Ne se check  napravi check drugite ostavi gi check
          if (checked != 'checked') {
            nodeList[i].click();
            nodeList[i].setAttribute("checked", "checked")
            let id = nodeList[i].getAttribute("id");
          }
        }

      } else {
        let nodeList = this.firstTabCandidatesDOM.nativeElement.querySelectorAll('input');
        console.log("Checked FAlse")
        for (let i = 0; i < nodeList.length; i++) {
          let checked = nodeList[i].getAttribute("checked");

          //na unselect na site sto se check napravi Uncheck
          if (checked == 'checked') {
            nodeList[i].click();

            nodeList[i].removeAttribute("checked")
            let id = nodeList[i].getAttribute("id");
          }
        }
      }
    } else {

      if (this.isCheckAll === true) {

        console.log("Checked ALL")

        let nodeList = this.NotfirstTabCandidatesDOM.nativeElement.querySelectorAll('input');

        for (let i = 0; i < nodeList.length; i++) {

          let id = nodeList[i].getAttribute("id");//ova id e so tabName

          let idWithTabName = id
          let res = idWithTabName.substr(0, idWithTabName.indexOf(' '));
          console.log("RES " + res)

          let checked = this.checkbox.filter(c => c == res)

          console.log("Dali e checked " + checked)

          if (checked.length === 0) {
            for (let i = 0; i < this.currentTabCandidates.length; i++) {
              let id = nodeList[i].getAttribute("id");//ova id e so tabName
              let idWithTabName = id
              let res = idWithTabName.substr(0, idWithTabName.indexOf(' '));
              console.log("RES " + res)
              if (Number.parseInt(res) === this.currentTabCandidates[i].id) {
                console.log("check " + id)
                this.currentTabCandidates[i].checked = true;
              }
            }

            let id = nodeList[i].getAttribute("id");//ova id e so tabName
            console.log(id + " ne e checked sega check")
            nodeList[i].click();
            console.log("Id " + id)
          }
        }

      } else {
        console.log("UNCheck all")

        let nodeList = this.NotfirstTabCandidatesDOM.nativeElement.querySelectorAll('input');

        for (let i = 0; i < nodeList.length; i++) {

          let id = nodeList[i].getAttribute("id");//ova id e so tabName

          let idWithTabName = id
          let res = idWithTabName.substr(0, idWithTabName.indexOf(' '));
          console.log("RES " + res)

          let checked = this.checkbox.filter(c => c == res)

          //na unselect na site sto se check napravi Uncheck
          if (checked.length != 0) {

            for (let i = 0; i < this.currentTabCandidates.length; i++) {
              let id = nodeList[i].getAttribute("id");//ova id e so tabName
              let idWithTabName = id
              let res = idWithTabName.substr(0, idWithTabName.indexOf(' '));

              console.log("RES " + res)
              if (Number.parseInt(id) === this.currentTabCandidates[i].id) {
                console.log("Uncheck " + id)
                this.currentTabCandidates[i].checked = false;
              }

            }
            console.log("Unchec Click")
            nodeList[i].click();
          }
        }
      }
    }
  }



  //to relaod the lists so that they re render all unchecked
  reloadCandidates() {
    this.checkbox = []
    let canidates = this.candidates;
    this.candidates = new Array<Candidate>();

    for (let i = 0; i < canidates.length; i++) {

      let can = new Candidate();
      can.id = canidates[i].id
      can.fullName = canidates[i].fullName
      can.email = canidates[i].email
      can.CV = canidates[i].CV
      can.password = canidates[i].password
      can.age = canidates[i].age
      can.token = canidates[i].token

      this.candidates.push(can)
    }

    let canidatesCurrentTab = this.currentTabCandidates;

    this.currentTabCandidates = new Array<CandidateForCheckBox>();

    for (let i = 0; i < canidatesCurrentTab.length; i++) {

      let can = new CandidateForCheckBox();
      can.id = canidatesCurrentTab[i].id
      can.fullName = canidatesCurrentTab[i].fullName
      can.email = canidatesCurrentTab[i].email
      can.age = canidatesCurrentTab[i].age

      this.currentTabCandidates.push(can)
    }
  }



  ///koga gi menuvan ovie  uncheck all checkboxs pa  zatoa  this.reloadCandidates()
  public sendEmailAction() {
    this.isViewCv = false;
    this.isViewCandidate = false;
    this.isSendEmailAction = true;
    this.emails = ""
    this.currentCandidate = undefined
    this.pdfSrc = ""
    this.reloadCandidates()
  }

  public viewCvAction() {
    this.isViewCv = true;
    this.isSendEmailAction = false;
    this.isViewCandidate = false;
    this.emails = ""
    this.currentCandidate = undefined
    this.pdfSrc = ""
    this.reloadCandidates()
  }

  public viewCandiateAction() {
    this.isViewCv = false;
    this.isSendEmailAction = false;
    this.isViewCandidate = true;
    this.emails = ""
    this.currentCandidate = undefined
    this.pdfSrc = ""
    this.reloadCandidates()
  }


  public deleteEmptyEmails(emails: Array<string>): Array<string> {

    for (let i = 0; i < emails.length; i++) {
      if (emails[i] == "") {
        emails.splice(i, 1);
      }
    }
    return emails;
  }


  public sendEmail(form: NgForm) {
    if (form.valid) {
      this.errorForm = false;
      let subjectEmail = form.controls.subject.value
      let messageEmail = form.controls.message.value
      let emails: Array<string>;
      let error;
      error = false;
      let invalidEmails: Array<string>;
      invalidEmails = new Array<string>();

      emails = this.emails.split(",")

      emails = this.deleteEmptyEmails(emails);

      emails.forEach(email => {

        let exists = this.candidates.filter(candidate => {

          return candidate.email === email;
        })

        console.log(exists.length)
        if (exists.length <= 0) {
          error = true;
          invalidEmails.push(email);
          console.log("pushed " + email)
        }
      });

      console.log(invalidEmails)

      if (error === true) {
        let message: string
        message = "";

        invalidEmails.forEach(email => {
          message = message.concat(email, ",")
        })

        this.restError = "Candiadtes with the follwoing emials do not exists you can send emials only to the candidates that applied for the job: " + message
        $('#ErrorModal').modal('show');
      } else {

        alert("Sended Emails")

        let ids = this.checkbox;

        this.recruiterService.sendEmailToCandidates(ids, subjectEmail, messageEmail)
          .subscribe((data) => {
            form.reset();
            this.emails = "";

          }, (err) => {
            this.restError = err.error;
            $('#ErrorModal').modal('show');
          })
      }
    } else {
      this.errorForm = true;
    }
  }


  checkBoxClicked(id: number, input: HTMLInputElement, firstTab: boolean) {
    console.log(input)
    const index = this.checkbox.indexOf(id)
    console.log("CheckboxClicked")
    console.log(id)
    console.log(this.checkbox)
    //ako go ima izbrisi go
    console.log("index " + index)

    if (index > -1) {
      console.log("deliting " + id)

      this.currentCandidate = undefined
      this.pdfSrc = ""

      const candidateIndexSelected = this.candidates.findIndex(c => c.id === id)

      let candiateSelected = this.candidates[candidateIndexSelected];
      let email = candiateSelected.email;

      this.emails = this.emails.replace(email.toString() + ",", "")

      this.checkbox.splice(index, 1);
      if (firstTab)
        input.removeAttribute("checked")
    } else {//ako go nema stavi go vo lista
      console.log("add " + id)
      this.checkbox.push(id);

      if (firstTab)
        input.setAttribute("checked", "checked");

      if (this.isViewCv == true) {
        this.recruiterService.recruiterGetCandidateCv(id).subscribe((data) => {
          console.log(data)
          const fileUrl = URL.createObjectURL(data);
          this.pdfSrc = fileUrl;

        }, (err) => {
          console.log("EROROROROOROROROORO");
          this.pdfSrc = ' ';
        })
      } else if (this.isSendEmailAction == true) {
        const candidateIndexSelected = this.candidates.findIndex(c => c.id === id)
        console.log("candidateIndexSelected")
        console.log(candidateIndexSelected)
        let candiateSelected = this.candidates[candidateIndexSelected];

        let email = candiateSelected.email;
        this.emails = this.emails.concat(email + ",")
        console.log("EMAILSSSSS")
        console.log(this.emails)

      } else if (this.isViewCandidate == true) {
        const candidateIndexSelected = this.candidates.findIndex(c => c.id === id)
        let candiateSelected = this.candidates[candidateIndexSelected];
        this.currentCandidate = candiateSelected;
      }
    }
  }



  next() {

    this.emails = "";
    this.currentCandidate = undefined

    const currentIndex = this.tabs.findIndex(t => t.tabName === this.currentTabName)
    console.log("index of this item " + currentIndex)

    if (currentIndex > -1) {
      const tab = this.tabs[currentIndex + 1];

      const indexNext = this.tabs.findIndex(t => t.tabName === tab?.tabName)
      console.log("index of next item " + indexNext)
      if (indexNext > -1) {
        console.log("Postoi Next");

        this.recruitmentProcessService
          .nextStepCandidate(this.checkbox, this.recruitmentProcessId, tab.id).subscribe(
            () => {

              this.checkbox = [];
              this.emails = ""
              this.currentCandidate = undefined
              this.pdfSrc = ""
              this.isCheckAll = false;

              if (this.tabs[currentIndex + 1] === undefined) {
                alert("No next")
              } else {

                //NESTO SE SMENILO ODNSONO CANDIDAAT VIL PREFRLEN ZEMI PAK TABS
                this.tabService.getTabsForRecruitmentProcess(this.recruitmentProcessId, '')
                  .subscribe((data: Array<Tab>) => {
                    console.log("GetTabsForRecruitmentProcess NESTO SE SMENILO")
                    console.log(data)
                    this.tabs = data;

                    const nextTab = this.tabs[currentIndex + 1];

                    const indexNext = this.tabs.findIndex(t => t.tabName === nextTab.tabName)

                    if (indexNext > -1) {

                      console.log("Tabs")
                      console.log(this.tabs)
                      console.log("Next tab")
                      console.log(this.tabs[indexNext])

                      this.tabClicked(this.tabs[indexNext].tabName)
                      this.getClassTab(this.tabs[indexNext].tabName)
                      this.getClassTabContent(this.tabs[indexNext].tabName)

                    } else { alert("No next") }

                  }, (err) => {
                    this.restError = err.error;
                    $('#ErrorModal').modal('show');
                  })
              }

            }, (err) => {
              this.restError = err.error;
              $('#ErrorModal').modal('show');
            })
      } else {
        alert("Next Tab does not exists")
      }

    } else {
      alert("Current tab does not exists")
    }
  }


  back() {
    this.emails = "";
    this.currentCandidate = undefined

    const currentIndex = this.tabs.findIndex(t => t.tabName === this.currentTabName)
    console.log("index of this item " + currentIndex)

    if (currentIndex > -1) {
      const tab = this.tabs[currentIndex - 1];

      const indexPrev = this.tabs.findIndex(t => t.tabName === tab?.tabName)
      console.log("index of next item " + indexPrev)
      if (indexPrev > -1) {
        console.log("Postoi Prev");

        this.recruitmentProcessService
          .backStepCandidate(this.checkbox, this.recruitmentProcessId, tab.id).subscribe(
            () => {

              this.checkbox = [];
              this.emails = ""
              this.currentCandidate = undefined
              this.pdfSrc = ""
              this.isCheckAll = false;

              if (this.tabs[currentIndex - 1] === undefined) {
                alert("No back")
              } else {

                //NESTO SE SMENILO ODNSONO CANDIDAAT VIL PREFRLEN ZEMI PAK TABS
                this.tabService.getTabsForRecruitmentProcess(this.recruitmentProcessId, '')
                  .subscribe((data: Array<Tab>) => {
                    console.log("GetTabsForRecruitmentProcess NESTO SE SMENILO")
                    console.log(data)
                    this.tabs = data;

                    const backTab = this.tabs[currentIndex - 1];

                    const indexBack = this.tabs.findIndex(t => t.tabName === backTab.tabName)

                    if (indexBack > -1) {

                      console.log("Tabs")
                      console.log(this.tabs)
                      console.log("Back tab")
                      console.log(this.tabs[indexBack])

                      this.tabClicked(this.tabs[indexBack].tabName)
                      this.getClassTab(this.tabs[indexBack].tabName)
                      this.getClassTabContent(this.tabs[indexBack].tabName)

                    } else { alert("No back") }

                  }, (err) => {
                    this.restError = err.error;
                    $('#ErrorModal').modal('show');
                  })
              }
            }, (err) => {
              this.restError = err.error;
              $('#ErrorModal').modal('show');

            })
      } else {
        alert("Back Tab does not exists")
      }

    } else {
      alert("Current tab does not exists")
    }
  }


  getClassTab(item: string): any {
    if (item === this.currentTabName) {
      return {
        ' nav-link relposclass active': true
      };
    } else {
      return {
        ' nav-link relposclass': true
      };
    }
  }


  getClassTabContent(item: string): any {
    if (item === this.currentTabName) {
      return {
        'tab-pane fade': true,
        'active show': true
      };
    } else {
      return {
        'tab-pane fade': true,
        'active show': false
      };
    }
  }


  deleteTab(item: string) {
    this.emails = ""
    this.isCheckAll = false;
    this.currentCandidate = undefined
    this.pdfSrc = ""
    console.log(item + " Deleting")
    console.log(this.tabs);
    const index = this.tabs.findIndex(t => t.tabName == item.toString())

    console.log(index + " of tab to dlete")

    if (index > -1) {

      let tab = this.tabs[index];

      this.tabService.deleteTab(tab).subscribe(() => {
        console.log(" Deleted")
        this.tabs.splice(index, 1);
      }, (err) => {

        this.restError = err.error;
        $('#ErrorModal').modal('show');
      })
    }
  }



  public tabClicked(item: string): void {
    this.checkbox = [];
    this.isCheckAll = false;
    this.emails = "";
    this.currentCandidate = undefined//for Candidate Action Tab

    console.log("TabClicked " + item)
    this.currentTabName = item;
    console.log("this.tabs")
    console.log(this.tabs)
    let arraySorted = this.tabs.sort((a, b) => a.id - b.id)
    console.log("arraySorted")
    console.log(arraySorted)
    let first = arraySorted[0];

    if (first.tabName == item) {
      this.firstTabAllCandidates = true
    } else {
      this.firstTabAllCandidates = false;
    }

    //for having unique checkbox id
    this.currentTabCandidates = new Array<CandidateForCheckBox>();

    const index = this.tabs.findIndex(t => t.tabName === item)

    if (index > -1) {
      console.log("Tab exists");

      //prviot tab nema candidati vo candidatesDto i zatoa nema da se izvrsi ova dole
      //duri i da se izvrsi nema da se prikaze zaradi firstTabAllCandidates true vo html
      for (let i = 0; i < this.tabs[index].candidatesDto.length; i++) {
        console.log("ADDING");
        let tabsCandidates = this.tabs[index].candidatesDto[i];

        console.log(tabsCandidates.candidateDto);

        let candidateForCheckBox = new CandidateForCheckBox();

        candidateForCheckBox.fullName = tabsCandidates.candidateDto.fullName;
        candidateForCheckBox.email = tabsCandidates.candidateDto.email;
        candidateForCheckBox.id = tabsCandidates.candidateDto.id;
        candidateForCheckBox.age = tabsCandidates.candidateDto.age;
        candidateForCheckBox.tabName = item

        this.currentTabCandidates.push(candidateForCheckBox)

        console.log("this.currentTabCandidates")
        console.log(this.currentTabCandidates)
      }
    }
    this.stepNumber = this.tabs.findIndex(t => t.tabName === this.currentTabName) + 1;
    this.calculatePercent();//stepNumber e potrebno za CalculatePercent
  }




  calculatePercent(): void {
    const total = this.tabs.length;
    console.log(total);
    const percent = (parseInt(this.stepNumber) / total) * 100;
    console.log(percent);
    this.progress.nativeElement.setAttribute('style', 'width: ' + percent + '%;');
    this.progress.nativeElement.innerHTML = 'Step ' + this.stepNumber + ' of ' + total;
  }


  ngAfterViewInit(): any {
    const total = this.tabs.length;
    let percent;
    if (total === 0) {
      percent = 0;
    } else {
      percent = (parseInt(this.stepNumber) / total) * 100;
    }
    this.progress.nativeElement.setAttribute('style', 'width: ' + percent + '%;');
    this.progress.nativeElement.innerHTML = 'Steppppp ' + this.stepNumber + ' of ' + total;
  }


  ngOnInit(): void {

    //showing contnent of tabs when clicked
    $('#myTab a').on('click', function (e) {
      e.preventDefault();
      $(this).tab('show');
    });

    this.activeRoute.paramMap.subscribe(params => {
      const recruitmentProcessId = params.get('recruitmentProcessId');
      this.recruitmentProcessId = (Number.parseInt(recruitmentProcessId));

      this.recruitmentProcessService.getRecruitmentProcessById(this.recruitmentProcessId)
        .subscribe((data: RecruitmentProcess) => {

          this.recruitmentProcess = data;

          console.log(this.recruitmentProcess)
        }, (err) => {
          this.restError = err.error;
          $('#ErrorModal').modal('show');
        })


      this.tabService.getTabsForRecruitmentProcess(this.recruitmentProcessId, '')
        .subscribe((data: Array<Tab>) => {
          console.log("GetTabsForRecruitmentProcess")
          console.log(data)
          this.tabs = data;

        }, (err) => {
          console.log("TAB ERROR")
        })


      this.recruitmentProcessService.getCandidatesForRecruitmentProcess(this.recruitmentProcessId, '')
        .subscribe(
          (data: Array<Candidate>) => {
            console.log("GetCandidatesForRecruitmentProcess")
            console.log(data)
            this.candidates = data;

          }, (err) => {
            this.restError = err.error;
            $('#ErrorModal').modal('show');
          })
    })
  }



  addNewTab(newtab: HTMLInputElement) {
    let tab = new Tab();
    tab.tabName = newtab.value.toString();
    let recruitmentProcessNoRelative = new RecruitmentProcessNoRelative();
    recruitmentProcessNoRelative.id = this.recruitmentProcess.id;
    tab.recruitmentProcessNoRelative = recruitmentProcessNoRelative;

    console.log(tab)
    this.tabService.createTab(tab).subscribe((data: Tab) => {
      console.log("Added")
      console.log(data)
      let tab = data;
      this.tabs.push(tab)

    }, (err) => {
      console.log(err.error);
      this.restError = err.error;
      $('#ErrorModal').modal('show');

    })
  }

  getValidationMessages(input: any, ref: any): any {
    return this.validationService.getValidationMessages(input, ref);
  }

}



```

<b>Html file</b>
```

<div class="mt-3 ml-3 mr-3 mb-3">
  <div class="container-fluid">

    <div class="progress">
      <div #progressBar class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="1" aria-valuemin="1"
        aria-valuemax="5" style="width: 20%;">
      </div>
    </div>

    <!-- Nav tabs -->
    <ul class="mt-1 nav nav-tabs" id="myTab" role="tablist">
      <li *ngFor="let item of tabs; let i = index" class="nav-item">
        <a class="nav-link relposclass" [ngClass]="getClassTab(item.tabName)" (click)="tabClicked(item.tabName)"
          href="#{{item.tabName}}" id="{{item.tabName}}" data-toggle="tab" role="tab" aria-controls="{{item.tabName}}">
          {{item.tabName}}
          <span (click)="deleteTab(item.tabName)" class="topright" style="color: rgb(231, 6, 6);">
            <i class="fas fa-times fa-xs"></i>
          </span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" id="add-tab" href="#add" data-toggle="tab" data-step="4" role="tab" aria-controls="add"
          aria-selected="false">
          <form class="form-inline">
            <input #newtabname size="8" class="mr-1 form-control form-control-sm" type="text" placeholder="Add new tab">
            <span (click)="addNewTab(newtabname)">

              <i class="far fa-plus-square fa-lg"></i>
            </span>

          </form>
        </a>
      </li>

    </ul>

    <!-- tab content -->
    <div class="tab-content" id="myTabContent">

      <div *ngFor="let item of tabs; let i = index" [ngClass]="getClassTabContent(item.tabName)" id="{{item.tabName}}"
        role="tabpanel" aria-labelledby="{{item.tabName}}">

        {{item.tabName}}

        <div class="container-fluid">
          <div class="row">

            <div class="col-sm-12 col-md-4 col-lg-4 col-xl-4">
              <div class="card bg-light mb-3" style="max-width: 100%; height: 25rem;">
                <div class="card-header">

                  <div class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
                    <div class="input-group">
                      <input [(ngModel)]="searchQuery" class="form-control form-control-sm" #searchCandidates
                        type="text" placeholder="Search for candidates" aria-label="Search"
                        aria-describedby="basic-addon2" />
                      <div class="input-group-append">
                        <button class="btn btn-primary btn-sm" (click)="searchCandidates(searchCandidates.value)"
                          type="button"><i class="fas fa-search"></i></button>
                      </div>
                    </div>
                  </div>

                  <div class="selectall">
                    <input [(ngModel)]="checkAll" (click)="selectAllCheckboxClicked()" #selectall type="checkbox"
                      class="form-control-input" id="selectall">
                    <label (click)="labelClick(selectall)" class="ml-2 smaller form-control-label">
                      select all
                    </label>
                  </div>

                </div>
                <div class="card-body scroll">

                  <div *ngIf="firstTabAllCandidates;else notFirstTab" #firstTabCandidatesDOM>
                    <div *ngFor="let item of candidates; let i = index;" class="custom-control form-checkbox mb-3">
                      <input (click)="checkBoxClicked(item.id,inputClicked,true)" #inputClicked type="checkbox"
                        class="mr-2 form-control-input" id="{{item.id}}">
                      <label class="smaller form-control-label" for="{{item.id}}">
                        {{item.fullName}}
                        <br />
                        {{item.email}}
                      </label>
                    </div>
                  </div>

                  <ng-template #notFirstTab>
                    <div #NotfirstTabCandidatesDOM>
                      <div *ngFor="let item of currentTabCandidates; let i = index;"
                        class="custom-control form-checkbox mb-3">
                        <input (click)="checkBoxClicked(item.id,inputClicked,false)" #inputClicked type="checkbox"
                          class="mr-2 form-control-input" id="{{item.id}} {{item.tabName}}" [(ngModel)]="item.checked">
                        <label class="smaller form-control-label" (click)=labelClick(inputClicked)>
                          {{item.fullName}}
                          <br />
                          {{item.email}}
                        </label>
                      </div>
                    </div>
                  </ng-template>
                </div>

                <div class="card-footer">
                  <button type="button" (click)="Back()" class="btn btn-secondary btn-sm floatleft">Back</button>

                  <button type="button" (click)="Next()" class="btn btn-success btn-sm floatright">Next</button>

                </div>

              </div>
            </div>

            <div class="col-sm-12 col-md-8 col-lg-8 col-xl-8">

              <div class="card">
                <div class="card-header">
                  <div class="btn-group btn-group-toggle floatright" data-toggle="buttons">

                    <label class="btn btn-secondary btn-sm" [ngClass]="getActionClass('Candiate')">
                      <input type="radio" (click)="viewCandiateAction()" name="options" id="option1" autocomplete="off"
                        checked>
                      Candiate
                    </label>

                    <label class="btn btn-secondary btn-sm" [ngClass]="getActionClass('View CV')">
                      <input type="radio" (click)="viewCvAction()" name="options" id="option1" autocomplete="off">
                      View CV
                    </label>

                    <label class="btn btn-secondary btn-sm" [ngClass]="getActionClass('Send Email')">
                      <input type="radio" (click)="sendEmailAction()" name="options" id="option3" autocomplete="off">
                      Send Email
                    </label>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-body paddingzero">

                    <div *ngIf="isSendEmailAction">
                      <form novalidate #form="ngForm" (ngSubmit)="sendEmail(form)">


                        <div class="input-group mb-2 input-group-sm">
                          <div class="input-group-prepend">
                            <div class="input-group-text">
                              <label class="labelsmall" (click)=labelClickFocus(to) for="ToInputGroup">To: </label>
                            </div>
                          </div>
                          <input #to [(ngModel)]="emails" #email="ngModel" ngModel name="emails" required #inputemail
                            validationmessage="email" type="email" class="form-control form-control-sm"
                            id="ToInputGroup">
                        </div>
                        <ul class="text-danger list-unstyled" *ngIf="email.touched && email.invalid">

                          <li *ngFor="let error of getValidationMessages(email,inputemail)">

                            {{error}}
                          </li>
                        </ul>

                        <div class="input-group mb-2 input-group-sm">
                          <div class="input-group-prepend">
                            <div class="input-group-text">
                              <label class="labelsmall" (click)=labelClickFocus(subclick)
                                for="SubjectInputGroup">Subject: </label>
                            </div>
                          </div>
                          <input #subclick #subject="ngModel" ngModel name="subject" required #inputsubject
                            validationmessage="subject" type="text" class="form-control form-control-sm"
                            id="SubjectInputGroup">
                        </div>
                        <ul class="text-danger list-unstyled" *ngIf="subject.touched && subject.invalid">

                          <li *ngFor="let error of getValidationMessages(subject,inputsubject)">

                            {{error}}
                          </li>
                        </ul>

                        <div class="form-group">
                          <label (click)=labelClickFocus(area) for="Textarea1">Message: </label>
                          <textarea #area #message="ngModel" ngModel name="message" required #inputmessage
                            validationmessage="message" class="form-control form-control-sm" id="Textarea1"
                            rows="3"></textarea>
                        </div>
                        <ul class="text-danger list-unstyled" *ngIf="message.touched && message.invalid">

                          <li *ngFor="let error of getValidationMessages(message,inputsubject)">

                            {{error}}
                          </li>
                        </ul>

                        <button type="submit" class="btn btn-primary">Send</button>
                      </form>
                      <div class="mt-3 text-danger" *ngIf="errorForm==true">
                        Form is Invalid
                      </div>
                    </div>

                    <div *ngIf="isViewCv">
                      <pdf-viewer [src]="pdfSrc" [render-text]="true" [original-size]="false" style="display: block;">
                      </pdf-viewer>
                    </div>

                    <div *ngIf="isViewCandidate">

                      {{currentCandidate?.fullName}}
                      <br>
                      {{currentCandidate?.email}}

                    </div>

                  </div>

                </div>

              </div>

            </div>

          </div>

        </div>

      </div>

    </div>

  </div>

  <modal-error [restError]='restError'></modal-error>

</div>

```








